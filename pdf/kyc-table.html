<html>
<head>
<script src="libs/jquery-1.9.1.min.js"></script>
<script src="libs/moment.min.js"></script>
<script src="libs/shared.js"></script>
<script>

$(function () {
    var data= {
    	title: "Customers",
    	startDate: 1399507200000,
    	endDate: 1407369599999,
    	data: "{\"Name\":[\"Joe DebonoJoe DebonoJoe DebonoJoe DebonoJoe DebonoJoe DebonoJoe Debono\",\"John Kelly\",\"Wendy Harris\",\"Brian Meggs\",\"Brian Long\",\"Stephen Devine\",\"Tom Street\",\"alan donn\",\"caio ricci\",\"Lawrence Cohen\",\"Nick Ramsden\",\"Kenny  Wilkins\",\"Jane  Carey\",\"Barry Galvin\",\"kane westwood\",\"Barbara Chapman\",\"James Stevens\",\"Clive Pilcher\",\"Andrew Riley\",\"Joe Debono\",\"John Kelly\",\"Wendy Harris\",\"Brian Meggs\",\"Brian Long\",\"Stephen Devine\",\"Tom Street\",\"alan donn\",\"caio ricci\",\"Lawrence Cohen\",\"Nick Ramsden\",\"Kenny  Wilkins\",\"Jane  Carey\",\"Barry Galvin\",\"kane westwood\",\"Barbara Chapman\",\"James Stevens\",\"Clive Pilcher\",\"Andrew Riley\"],\"Total Spent\":[33,31.3,30.5,21.6,14,13.7,13.4,13,11.8,8,7.3,7,6.7,6.6,6.6,5.5,4.8,4.8,2.5,33,31.3,30.5,21.6,14,13.7,13.4,13,11.8,8,7.3,7,6.7,6.6,6.6,5.5,4.8,4.8,2.5],\"Email Address\":[\"joe@drs-caterers.com\",\"seankelly69@icloud.com\",\"wendyjharris@hotmail.co.uk\",\"brian.meggs@informa.com\",\"brianlong@ntlworld.com\",\"sjpdevine2000@yahoo.co.uk\",\"tomstreer@hotmail.co.uk\",\"donn111@live.co.uk\",\"caio.ricci@gmail.com\",\"laerence.cojen@hotmail.co.uk\",\"n.ramsden1@gmail.com\",\"knnwlkns2000@yahoo.co.uk\",\"janecarey@yahoo.co.uk\",\"b.galvin@virginmedia.com\",\"kane.westwood@googlemail.com\",\"barbarachapman2001@yahoo.co.uk\",\"james.stevens@harpercollins.co.uk\",\"clivepilcher@yahoo.co.uk\",\"andrewdavidriley@gmail.com\",\"joe@drs-caterers.com\",\"seankelly69@icloud.com\",\"wendyjharris@hotmail.co.uk\",\"brian.meggs@informa.com\",\"brianlong@ntlworld.com\",\"sjpdevine2000@yahoo.co.uk\",\"tomstreer@hotmail.co.uk\",\"donn111@live.co.uk\",\"caio.ricci@gmail.com\",\"laerence.cojen@hotmail.co.uk\",\"n.ramsden1@gmail.com\",\"knnwlkns2000@yahoo.co.uk\",\"janecarey@yahoo.co.uk\",\"b.galvin@virginmedia.com\",\"kane.westwood@googlemail.com\",\"barbarachapman2001@yahoo.co.uk\",\"james.stevens@harpercollins.co.uk\",\"clivepilcher@yahoo.co.uk\",\"andrewdavidriley@gmail.com\"],\"Loyalty\":[0,1,0,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1],\"Offers\":[0,1,0,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1],\"Other\":[0,0,0,1,0,0,0,1,0,0,0,0,1,0,1,1,0,1,1,0,0,0,1,0,0,0,1,0,0,0,0,1,0,1,1,0,1,1]}"
    };
    
		var parsedData = JSON.parse(data.data);
		var pageCount = 0;
		var maxRows = 20;
    $('.title').html(data.title);

    $('.dates').html(formatDate(data.startDate) + " - " + formatDate(data.endDate));

  	function formatPercentage(val){	
    		var strVal = String(val);
				if (val <0 )
					strVal = "-"+strVal;
				else
					strVal = "+"+strVal;
				return strVal+"%";
	}

		var headerRow = []
		var dataRows = [];

		var heightLine = 40;
		var heightBreakLine = 19;
		console.log(parsedData);
		$.each(parsedData,function(title,dataArray){
				var td = "<th>"+title+"</th>"
				headerRow.push(td);
				$.each(dataArray,function(i,value){
					if (dataRows[i] == undefined)
						dataRows[i] = [];
					var rowTd  = "<td>"+value+"</td>"
					dataRows[i].push(rowTd);
				})
		})

		function insertHeader(tableId){
			var tableHeader = $('#'+tableId+' thead tr');
			$.each(headerRow,function(k,v){
					tableHeader.append(v);
			})
		}

		function insertRow(tableId,row){
			$('#'+tableId+' tbody').append('<tr>'+row+'</tr>');

			var $row = $('#'+tableId+' tbody').children('tr').last();

			var heightTd = $row.children('td').outerHeight() + $row.children('td').innerHeight();

			if ( heightTd > heightLine ) {

				var substractHeight = heightTd - heightLine;

				maxRows = maxRows - ( substractHeight / heightBreakLine );
			}
		}

		var tableId;
		$.each(dataRows,function(k,rowItems){
			if (k % maxRows === 0){
				if (k > 0){
					insertFooter('',tableId);
				}
				tableId = insertTable();
				insertHeader(tableId);

				maxRows = 20;
			}
			var ui_str = '';
			$.each(rowItems,function(i,v){
				ui_str +=v;
			});			
			insertRow(tableId,ui_str);						
		})
		insertFooter('never',tableId);
    	
    function insertTable(){
			pageCount++;
			var id = 'table_'+pageCount;
		  var ui_str = '<div class="content-table" id='+id+'>';
				ui_str += '	<table class="table table-striped table-list">';
				ui_str += '	  <thead>';
				ui_str += '	  	<tr>';
				ui_str += '	  	</tr>';
				ui_str += '	  </thead>';
				ui_str += '	  <tbody>';
				ui_str += '	  </tbody>';
				ui_str += '	</table>';
				ui_str += '</div>';
				$('#content').append(ui_str);
				console.log('appended')
			return id;
    }
    
    
    function formatDate(ts){
        var date = new Date(ts);
        return date.getDate()+"/"+date.getMonth()+"/"+date.getFullYear();
    }

    function insertFooter(cl,tableId){
    	var ui_str= "<div class='footer "+cl+" '>";
			ui_str+= "	<div class='logo'>Report generated by <br/><img src='img/logo.png'/></div>";
			ui_str+= "</div>";
			var pager_str ="<div class='pageCount'>"+pageCount+"</div>"
			$('#content').append(ui_str);
			$('#'+tableId).append(pager_str);
    }

  });
</script>
<style>
	@font-face{
		font-family:"Co Text W01 Bold";
		src:url("fonts/fonts-com/137c5228-fcea-49b5-87a2-652892f35567.eot?#iefix");
		src:url("fonts/fonts-com/137c5228-fcea-49b5-87a2-652892f35567.eot?#iefix") format("eot"),url("fonts/fonts-com/48ad114c-19ab-41fc-92c3-eab9077289d4.woff") format("woff"),url("fonts/fonts-com/82715156-ba20-42e6-8103-3038d1ef9fb9.ttf") format("truetype"),url("fonts/fonts-com/f328709c-b561-4944-95c5-0c5a9ab1a87c.svg#f328709c-b561-4944-95c5-0c5a9ab1a87c") format("svg");
		}
		@font-face{
		font-family:"Co Text W01 Light";
		src:url("fonts/fonts-com/601bffc8-cea9-4d92-ac3f-617b85516156.eot?#iefix");
		src:url("fonts/fonts-com/601bffc8-cea9-4d92-ac3f-617b85516156.eot?#iefix") format("eot"),url("fonts/fonts-com/fe5ae5d6-d1f1-487e-9e59-76f5f199c3ae.woff") format("woff"),url("fonts/fonts-com/12ea435b-6a3a-4d98-bcf3-418174b701b7.ttf") format("truetype"),url("fonts/fonts-com/42dd9b27-137a-4cc1-a771-ef3625e2779c.svg#42dd9b27-137a-4cc1-a771-ef3625e2779c") format("svg");
	}
	body{
			font-family:"Co Text W01 Light","sans-serif";;
	}
	.title{
		float:left;		
		width:40%;
		text-align:left;
	}
	.dates{
		float:right;
		width:40%;
		text-align:right;
	}
	.clearFix{
		clear:both;
	}
	.header{
		border-bottom: 1px solid #ccc;
		padding-bottom: 10px;
		margin-bottom: 10px;
		font-family:"Co Text W01 Light","sans-serif";
	}
	.innerHeader{
		font-size: 200%;
		color: #1476B7;
		display: block;
		font-weight:bold;
		margin-bottom: 40px;
		font-family:"Co Text W01 Bold","Co Text W01 Light","sans-serif";

	}
	.innerHeader sup{
			font-size:50%;
			display:inline-block;
			margin-left:5px;
			color:#8cbe56;			
	}
	.footer{
		margin-top:80px;
		page-break-after: always;
	}

	.logo{
		float:right;
	}
	.never{
		page-break-before: avoid !important;
		page-break-after: avoid !important;
	}

	.table-list thead th{
  		cursor: pointer;
	}

	.content-table{
		position:relative;
		height:820px;
	}
	.pageCount{
		position:absolute;
		bottom:-100px;
		left:0;
	}

table {
	width:100%;
	margin:0 auto;
}

.table-striped{
  border-collapse: separate !important;
  border-radius: 5px;  
  overflow: hidden;
  border: 1px solid #b4b6b8; 

}

	table tr.alt, table tr.even, table tr:nth-of-type(even), table tbody:nth-of-type(even){
	  background-color:#fcfcfc;
	}

	.table-striped tr:first-child th{
	  border-top:none;
	}

	.table-striped td:last-child,.table-striped th:last-child{
	  border-right:none;
	}

	.table-striped td,.table-striped th{
	  font-family:"Co Text W01 Bold";
	  color: #6d6e71;
	  border-top: 1px solid #b4b6b8; 
	  border-right:1px solid #b4b6b8; 
	}

	.table-striped th input, .table-striped td input{
	  margin: 0px;
	}

	.table-striped thead tr th{
	  padding: 15px;
	  background-color: #F3F4F4 !important;
	  text-align:left;
	  font-weight: 400;
	}


	.table-striped tbody tr td{
	  padding: 10px 15px;
	}



</style>
</head>
<body>
<div class='header'>
		<div class='title'></div>
		<div class='dates'></div>
		<div class='clearFix'></div>
</div>

<div id='content'>
	
</div>
	
</body>
</html>
