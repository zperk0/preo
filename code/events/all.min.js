"use strict";!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(a){!function(a){if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof c&&"object"==typeof b)b.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else{if("undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");self.Q=a()}}(function(){function b(a){return function(){return X.apply(a,arguments)}}function c(a){return a===Object(a)}function d(a){return"[object StopIteration]"===db(a)||a instanceof T}function e(a,b){if(Q&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(eb)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var e=c.join("\n"+eb+"\n");a.stack=f(e)}}function f(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];i(e)||g(e)||!e||c.push(e)}return c.join("\n")}function g(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function h(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function i(a){var b=h(a);if(!b)return!1;var c=b[0],d=b[1];return c===S&&d>=U&&ib>=d}function j(){if(Q)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=h(c);if(!d)return;return S=d[0],d[1]}}function k(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",new Error("").stack),a.apply(a,arguments)}}function l(a){return a instanceof p?a:t(a)?C(a):B(a)}function m(){function a(a){b=a,f.source=a,Z(c,function(b,c){l.nextTick(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=ab(m.prototype),f=ab(p.prototype);if(f.promiseDispatch=function(a,e,f){var g=Y(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):l.nextTick(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){if(c)return f;var a=r(b);return s(a)&&(b=a),a},f.inspect=function(){return b?b.inspect():{state:"pending"}},l.longStackSupport&&Q)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(c){b||a(l(c))},e.fulfill=function(c){b||a(B(c))},e.reject=function(c){b||a(A(c))},e.notify=function(a){b||Z(d,function(b,c){l.nextTick(function(){c(a)})},void 0)},e}function n(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=m();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function o(a){return n(function(b,c){for(var d=0,e=a.length;e>d;d++)l(a[d]).then(b,c)})}function p(a,b,c){void 0===b&&(b=function(a){return A(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=ab(p.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=A(h)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function q(a,b,c,d){return l(a).then(b,c,d)}function r(a){if(s(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function s(a){return a instanceof p}function t(a){return c(a)&&"function"==typeof a.then}function u(a){return s(a)&&"pending"===a.inspect().state}function v(a){return!s(a)||"fulfilled"===a.inspect().state}function w(a){return s(a)&&"rejected"===a.inspect().state}function x(){fb.length=0,gb.length=0,hb||(hb=!0)}function y(a,b){hb&&(gb.push(a),fb.push(b&&"undefined"!=typeof b.stack?b.stack:"(no stack) "+b))}function z(a){if(hb){var b=$(gb,a);-1!==b&&(gb.splice(b,1),fb.splice(b,1))}}function A(a){var b=p({when:function(b){return b&&z(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return y(b,a),b}function B(a){return p({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return cb(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function C(a){var b=m();return l.nextTick(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function D(a){return p({isDef:function(){}},function(b,c){return J(a,b,c)},function(){return l(a).inspect()})}function E(a,b,c){return l(a).spread(b,c)}function F(a){return function(){function b(a,b){var g;if("undefined"==typeof StopIteration){try{g=c[a](b)}catch(h){return A(h)}return g.done?l(g.value):q(g.value,e,f)}try{g=c[a](b)}catch(h){return d(h)?l(h.value):A(h)}return q(g,e,f)}var c=a.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}}function G(a){l.done(l.async(a)())}function H(a){throw new T(a)}function I(a){return function(){return E([this,K(arguments)],function(b,c){return a.apply(b,c)})}}function J(a,b,c){return l(a).dispatch(b,c)}function K(a){return q(a,function(a){var b=0,c=m();return Z(a,function(d,e,f){var g;s(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,q(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function L(a){if(0===a.length)return l.resolve();var b=l.defer(),c=0;return Z(a,function(d,e,f){function g(a){b.resolve(a)}function h(){c--,0===c&&b.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function i(a){b.notify({index:f,value:a})}var j=a[f];c++,q(j,g,h,i)},void 0),b.promise}function M(a){return q(a,function(a){return a=_(a,l),q(K(_(a,function(a){return q(a,V,V)})),function(){return a})})}function N(a){return l(a).allSettled()}function O(a,b){return l(a).then(void 0,void 0,b)}function P(a,b){return l(a).nodeify(b)}var Q=!1;try{throw new Error}catch(R){Q=!!R.stack}var S,T,U=j(),V=function(){},W=function(){function b(){for(;c.next;){c=c.next;var a=c.task;c.task=void 0;var d=c.domain;d&&(c.domain=void 0,d.enter());try{a()}catch(f){if(g)throw d&&d.exit(),setTimeout(b,0),d&&d.enter(),f;setTimeout(function(){throw f},0)}d&&d.exit()}e=!1}var c={task:void 0,next:null},d=c,e=!1,f=void 0,g=!1;if(W=function(b){d=d.next={task:b,domain:g&&a.domain,next:null},e||(e=!0,f())},"undefined"!=typeof a&&a.nextTick)g=!0,f=function(){a.nextTick(b)};else if("function"==typeof setImmediate)f="undefined"!=typeof window?setImmediate.bind(window,b):function(){setImmediate(b)};else if("undefined"!=typeof MessageChannel){var h=new MessageChannel;h.port1.onmessage=function(){f=i,h.port1.onmessage=b,b()};var i=function(){h.port2.postMessage(0)};f=function(){setTimeout(b,0),i()}}else f=function(){setTimeout(b,0)};return W}(),X=Function.call,Y=b(Array.prototype.slice),Z=b(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),$=b(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),_=b(Array.prototype.map||function(a,b){var c=this,d=[];return Z(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),ab=Object.create||function(a){function b(){}return b.prototype=a,new b},bb=b(Object.prototype.hasOwnProperty),cb=Object.keys||function(a){var b=[];for(var c in a)bb(a,c)&&b.push(c);return b},db=b(Object.prototype.toString);T="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var eb="From previous event:";l.resolve=l,l.nextTick=W,l.longStackSupport=!1,"object"==typeof a&&a&&a.env&&a.env.Q_DEBUG&&(l.longStackSupport=!0),l.defer=m,m.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):a.resolve(arguments.length>2?Y(arguments,1):c)}},l.Promise=n,l.promise=n,n.race=o,n.all=K,n.reject=A,n.resolve=l,l.passByCopy=function(a){return a},p.prototype.passByCopy=function(){return this},l.join=function(a,b){return l(a).join(b)},p.prototype.join=function(a){return l([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},l.race=o,p.prototype.race=function(){return this.then(l.race)},l.makePromise=p,p.prototype.toString=function(){return"[object Promise]"},p.prototype.then=function(a,b,c){function d(b){try{return"function"==typeof a?a(b):b}catch(c){return A(c)}}function f(a){if("function"==typeof b){e(a,h);try{return b(a)}catch(c){return A(c)}}return A(a)}function g(a){return"function"==typeof c?c(a):a}var h=this,i=m(),j=!1;return l.nextTick(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(d(a)))},"when",[function(a){j||(j=!0,i.resolve(f(a)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!l.onerror)throw d;l.onerror(d)}c||i.notify(b)}]),i.promise},l.tap=function(a,b){return l(a).tap(b)},p.prototype.tap=function(a){return a=l(a),this.then(function(b){return a.fcall(b).thenResolve(b)})},l.when=q,p.prototype.thenResolve=function(a){return this.then(function(){return a})},l.thenResolve=function(a,b){return l(a).thenResolve(b)},p.prototype.thenReject=function(a){return this.then(function(){throw a})},l.thenReject=function(a,b){return l(a).thenReject(b)},l.nearer=r,l.isPromise=s,l.isPromiseAlike=t,l.isPending=u,p.prototype.isPending=function(){return"pending"===this.inspect().state},l.isFulfilled=v,p.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},l.isRejected=w,p.prototype.isRejected=function(){return"rejected"===this.inspect().state};var fb=[],gb=[],hb=!0;l.resetUnhandledRejections=x,l.getUnhandledReasons=function(){return fb.slice()},l.stopUnhandledRejectionTracking=function(){x(),hb=!1},x(),l.reject=A,l.fulfill=B,l.master=D,l.spread=E,p.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},l.async=F,l.spawn=G,l["return"]=H,l.promised=I,l.dispatch=J,p.prototype.dispatch=function(a,b){var c=this,d=m();return l.nextTick(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},l.get=function(a,b){return l(a).dispatch("get",[b])},p.prototype.get=function(a){return this.dispatch("get",[a])},l.set=function(a,b,c){return l(a).dispatch("set",[b,c])},p.prototype.set=function(a,b){return this.dispatch("set",[a,b])},l.del=l["delete"]=function(a,b){return l(a).dispatch("delete",[b])},p.prototype.del=p.prototype["delete"]=function(a){return this.dispatch("delete",[a])},l.mapply=l.post=function(a,b,c){return l(a).dispatch("post",[b,c])},p.prototype.mapply=p.prototype.post=function(a,b){return this.dispatch("post",[a,b])},l.send=l.mcall=l.invoke=function(a,b){return l(a).dispatch("post",[b,Y(arguments,2)])},p.prototype.send=p.prototype.mcall=p.prototype.invoke=function(a){return this.dispatch("post",[a,Y(arguments,1)])},l.fapply=function(a,b){return l(a).dispatch("apply",[void 0,b])},p.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},l["try"]=l.fcall=function(a){return l(a).dispatch("apply",[void 0,Y(arguments,1)])},p.prototype.fcall=function(){return this.dispatch("apply",[void 0,Y(arguments)])},l.fbind=function(a){var b=l(a),c=Y(arguments,1);return function(){return b.dispatch("apply",[this,c.concat(Y(arguments))])}},p.prototype.fbind=function(){var a=this,b=Y(arguments);return function(){return a.dispatch("apply",[this,b.concat(Y(arguments))])}},l.keys=function(a){return l(a).dispatch("keys",[])},p.prototype.keys=function(){return this.dispatch("keys",[])},l.all=K,p.prototype.all=function(){return K(this)},l.any=L,p.prototype.any=function(){return L(this)},l.allResolved=k(M,"allResolved","allSettled"),p.prototype.allResolved=function(){return M(this)},l.allSettled=N,p.prototype.allSettled=function(){return this.then(function(a){return K(_(a,function(a){function b(){return a.inspect()}return a=l(a),a.then(b,b)}))})},l.fail=l["catch"]=function(a,b){return l(a).then(void 0,b)},p.prototype.fail=p.prototype["catch"]=function(a){return this.then(void 0,a)},l.progress=O,p.prototype.progress=function(a){return this.then(void 0,void 0,a)},l.fin=l["finally"]=function(a,b){return l(a)["finally"](b)},p.prototype.fin=p.prototype["finally"]=function(a){return a=l(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},l.done=function(a,b,c,d){return l(a).done(b,c,d)},p.prototype.done=function(b,c,d){var f=function(a){l.nextTick(function(){if(e(a,g),!l.onerror)throw a;l.onerror(a)})},g=b||c||d?this.then(b,c,d):this;"object"==typeof a&&a&&a.domain&&(f=a.domain.bind(f)),g.then(void 0,f)},l.timeout=function(a,b,c){return l(a).timeout(b,c)},p.prototype.timeout=function(a,b){var c=m(),d=setTimeout(function(){b&&"string"!=typeof b||(b=new Error(b||"Timed out after "+a+" ms"),b.code="ETIMEDOUT"),c.reject(b)},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},l.delay=function(a,b){return void 0===b&&(b=a,a=void 0),l(a).delay(b)},p.prototype.delay=function(a){return this.then(function(b){var c=m();return setTimeout(function(){c.resolve(b)},a),c.promise})},l.nfapply=function(a,b){return l(a).nfapply(b)},p.prototype.nfapply=function(a){var b=m(),c=Y(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},l.nfcall=function(a){var b=Y(arguments,1);return l(a).nfapply(b)},p.prototype.nfcall=function(){var a=Y(arguments),b=m();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},l.nfbind=l.denodeify=function(a){var b=Y(arguments,1);return function(){var c=b.concat(Y(arguments)),d=m();return c.push(d.makeNodeResolver()),l(a).fapply(c).fail(d.reject),d.promise}},p.prototype.nfbind=p.prototype.denodeify=function(){var a=Y(arguments);return a.unshift(this),l.denodeify.apply(void 0,a)},l.nbind=function(a,b){var c=Y(arguments,2);return function(){function d(){return a.apply(b,arguments)}var e=c.concat(Y(arguments)),f=m();return e.push(f.makeNodeResolver()),l(d).fapply(e).fail(f.reject),f.promise}},p.prototype.nbind=function(){var a=Y(arguments,0);return a.unshift(this),l.nbind.apply(void 0,a)},l.nmapply=l.npost=function(a,b,c){return l(a).npost(b,c)},p.prototype.nmapply=p.prototype.npost=function(a,b){var c=Y(b||[]),d=m();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},l.nsend=l.nmcall=l.ninvoke=function(a,b){var c=Y(arguments,2),d=m();return c.push(d.makeNodeResolver()),l(a).dispatch("post",[b,c]).fail(d.reject),d.promise},p.prototype.nsend=p.prototype.nmcall=p.prototype.ninvoke=function(a){var b=Y(arguments,1),c=m();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},l.nodeify=P,p.prototype.nodeify=function(a){return a?void this.then(function(b){l.nextTick(function(){a(null,b)})},function(b){l.nextTick(function(){a(b)})}):this};var ib=j();return l})}).call(this,a("_process"))},{_process:28}],2:[function(a,b){b.exports={DELIVERY:"DELIVERY",SEAT:"SEAT",PICKUP:"PICKUP"}},{}],3:[function(a,b){b.exports={CASH:"CASH",CARD:"CARD"}},{}],4:[function(a,b,c){!function(a,d){"function"==typeof define&&define.amd?define(d):"object"==typeof c?b.exports=d:a.atomic=d(a)}(this,function(a){var b={},c=function(a){var b;try{b=JSON.parse(a.responseText)}catch(c){b=a.responseText}return[b,a]},d=function(b,d,e){var f={success:function(){},error:function(){}},g=a.XMLHttpRequest||ActiveXObject,h=new g("MSXML2.XMLHTTP.3.0");return h.open(b,d,!0),h.setRequestHeader("Content-type","application/json"),h.onreadystatechange=function(){4===h.readyState&&(h.status<300?f.success.apply(f,c(h)):f.error.apply(f,c(h)))},h.send(e),{success:function(a){return f.success=a,this},error:function(a){return f.error=a,this}}};return b.get=function(a){return d("GET",a)},b.put=function(a,b){return d("PUT",a,b)},b.patch=function(a,b){return d("PATCH",a,b)},b.post=function(a,b){return d("POST",a,b)},b["delete"]=function(a){return d("DELETE",a)},b})},{}],5:[function(a,b){(function(){var a,c,d,e,f,g={}.hasOwnProperty,h=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i=this;for(this.Stripe=function(){function a(){}return a.version=2,a.endpoint="https://api.stripe.com/v1",a.setPublishableKey=function(b){a.key=b},a.complete=function(b){return function(c){var d;return"success"!==c?(d=Math.round((new Date).getTime()/1e3),(new Image).src="https://q.stripe.com?event=stripejs-error&type="+c+"&key="+a.key+"&timestamp="+d,"function"==typeof b?b(500,{error:{code:c,type:c,message:"An unexpected error has occurred submitting your credit\ncard to our secure credit card processor. This may be\ndue to network connectivity issues, so you should try\nagain (you won't be charged twice). If this problem\npersists, please let us know!"}}):void 0):void 0}},a}.call(this),a=this.Stripe,this.Stripe.token=function(){function b(){}return b.validate=function(a,b){if(!a)throw b+" required";if("object"!=typeof a)throw b+" invalid"},b.formatData=function(b,c){return a.utils.isElement(b)&&(b=a.utils.paramsFromForm(b,c)),a.utils.underscoreKeys(b),b},b.create=function(b,c){return b.key||(b.key=a.key||a.publishableKey),a.utils.validateKey(b.key),a.ajaxJSONP({url:""+a.endpoint+"/tokens",data:b,method:"POST",success:function(a,b){return"function"==typeof c?c(b,a):void 0},complete:a.complete(c),timeout:4e4})},b.get=function(b,c){if(!b)throw"token required";return a.utils.validateKey(a.key),a.ajaxJSONP({url:""+a.endpoint+"/tokens/"+b,data:{key:a.key},success:function(a,b){return"function"==typeof c?c(b,a):void 0},complete:a.complete(c),timeout:4e4})},b}.call(this),this.Stripe.card=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return h(c,b),c.tokenName="card",c.whitelistedAttrs=["number","cvc","exp_month","exp_year","name","address_line1","address_line2","address_city","address_state","address_zip","address_country"],c.createToken=function(b,d,e){var f;return null==d&&(d={}),a.token.validate(b,"card"),"function"==typeof d?(e=d,d={}):"object"!=typeof d&&(f=parseInt(d,10),d={},f>0&&(d.amount=f)),d[c.tokenName]=a.token.formatData(b,c.whitelistedAttrs),a.token.create(d,e)},c.getToken=function(b,c){return a.token.get(b,c)},c.validateCardNumber=function(a){return a=(a+"").replace(/\s+|-/g,""),a.length>=10&&a.length<=16&&c.luhnCheck(a)},c.validateCVC=function(b){return b=a.utils.trim(b),/^\d+$/.test(b)&&b.length>=3&&b.length<=4},c.validateExpiry=function(b,c){var d,e;return b=a.utils.trim(b),c=a.utils.trim(c),/^\d+$/.test(b)&&/^\d+$/.test(c)&&parseInt(b,10)<=12?(e=new Date(c,b),d=new Date,e.setMonth(e.getMonth()-1),e.setMonth(e.getMonth()+1,1),e>d):!1},c.luhnCheck=function(a){var b,c,d,e,f,g;for(d=!0,e=0,c=(a+"").split("").reverse(),f=0,g=c.length;g>f;f++)b=c[f],b=parseInt(b,10),(d=!d)&&(b*=2),b>9&&(b-=9),e+=b;return e%10===0},c.cardType=function(a){return c.cardTypes[a.slice(0,2)]||"Unknown"},c.cardTypes=function(){var a,b,c,d;for(b={},a=c=40;49>=c;a=++c)b[a]="Visa";for(a=d=50;59>=d;a=++d)b[a]="MasterCard";return b[34]=b[37]="American Express",b[60]=b[62]=b[64]=b[65]="Discover",b[35]="JCB",b[30]=b[36]=b[38]=b[39]="Diners Club",b}(),c}.call(this,this.Stripe.token),this.Stripe.bankAccount=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return h(c,b),c.tokenName="bank_account",c.whitelistedAttrs=["country","routing_number","account_number"],c.createToken=function(b,d,e){return null==d&&(d={}),a.token.validate(b,"bank account"),"function"==typeof d&&(e=d,d={}),d[c.tokenName]=a.token.formatData(b,c.whitelistedAttrs),a.token.create(d,e)},c.getToken=function(b,c){return a.token.get(b,c)},c.validateRoutingNumber=function(b,d){switch(b=a.utils.trim(b),d){case"US":return/^\d+$/.test(b)&&9===b.length&&c.routingChecksum(b);case"CA":return/\d{5}\-\d{3}/.test(b)&&9===b.length;default:return!0}},c.validateAccountNumber=function(b,c){switch(b=a.utils.trim(b),c){case"US":return/^\d+$/.test(b)&&b.length>=1&&b.length<=17;default:return!0}},c.routingChecksum=function(a){var b,c,d,e,f,g;for(d=0,b=(a+"").split(""),g=[0,3,6],e=0,f=g.length;f>e;e++)c=g[e],d+=3*parseInt(b[c]),d+=7*parseInt(b[c+1]),d+=parseInt(b[c+2]);return 0!==d&&d%10===0},c}.call(this,this.Stripe.token),c=["createToken","getToken","cardType","validateExpiry","validateCVC","validateCardNumber"],e=0,f=c.length;f>e;e++)d=c[e],this.Stripe[d]=this.Stripe.card[d];"undefined"!=typeof b&&null!==b&&(b.exports=this.Stripe),"function"==typeof define&&define("stripe",[],function(){return i.Stripe})}).call(this),function(){var a,b,c,d=[].slice;a=encodeURIComponent,b=(new Date).getTime(),c=function(b,d,e){var f,g;null==d&&(d=[]);for(f in b)g=b[f],e&&(f=""+e+"["+f+"]"),"object"==typeof g?c(g,d,f):d.push(""+f+"="+a(g));return d.join("&").replace(/%20/g,"+")},this.Stripe.ajaxJSONP=function(a){var e,f,g,h,i,j;return null==a&&(a={}),g="sjsonp"+ ++b,i=document.createElement("script"),f=null,e=function(b){var c;return null==b&&(b="abort"),clearTimeout(f),null!=(c=i.parentNode)&&c.removeChild(i),g in window&&(window[g]=function(){}),"function"==typeof a.complete?a.complete(b,j,a):void 0},j={abort:e},i.onerror=function(){return j.abort(),"function"==typeof a.error?a.error(j,a):void 0},window[g]=function(){var b;b=1<=arguments.length?d.call(arguments,0):[],clearTimeout(f),i.parentNode.removeChild(i);try{delete window[g]}catch(c){window[g]=void 0}return"function"==typeof a.success&&a.success.apply(a,b),"function"==typeof a.complete?a.complete("success",j,a):void 0},a.data||(a.data={}),a.data.callback=g,a.method&&(a.data._method=a.method),i.src=a.url+"?"+c(a.data),h=document.getElementsByTagName("head")[0],h.appendChild(i),a.timeout>0&&(f=setTimeout(function(){return j.abort("timeout")},a.timeout)),j}}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};this.Stripe.utils=function(){function b(){}return b.trim=function(a){return(a+"").replace(/^\s+|\s+$/g,"")},b.underscore=function(a){return(a+"").replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()}).replace(/-/g,"_")},b.underscoreKeys=function(a){var b,c,d;d=[];for(b in a)c=a[b],delete a[b],d.push(a[this.underscore(b)]=c);return d},b.isElement=function(a){return"object"!=typeof a?!1:"undefined"!=typeof jQuery&&null!==jQuery&&a instanceof jQuery?!0:1===a.nodeType},b.paramsFromForm=function(b,c){var d,e,f,g,h,i,j,k,l,m;for(null==c&&(c=[]),"undefined"!=typeof jQuery&&null!==jQuery&&b instanceof jQuery&&(b=b[0]),f=b.getElementsByTagName("input"),h=b.getElementsByTagName("select"),i={},j=0,l=f.length;l>j;j++)e=f[j],d=this.underscore(e.getAttribute("data-stripe")),a.call(c,d)<0||(i[d]=e.value);for(k=0,m=h.length;m>k;k++)g=h[k],d=this.underscore(g.getAttribute("data-stripe")),a.call(c,d)<0||null!=g.selectedIndex&&(i[d]=g.options[g.selectedIndex].value);return i},b.validateKey=function(a){if(!a||"string"!=typeof a)throw new Error("You did not set a valid publishable key. Call Stripe.setPublishableKey() with your publishable key. For more info, see https://stripe.com/docs/stripe.js");if(/\s/g.test(a))throw new Error("Your key is invalid, as it contains whitespace. For more info, see https://stripe.com/docs/stripe.js");if(/^sk_/.test(a))throw new Error("You are using a secret key with Stripe.js, instead of the publishable one. For more info, see https://stripe.com/docs/stripe.js")},b}()}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};this.Stripe.validator={"boolean":function(a,b){return"true"!==b&&"false"!==b?"Enter a boolean string (true or false)":void 0},integer:function(a,b){return/^\d+$/.test(b)?void 0:"Enter an integer"},positive:function(a,b){return!this.integer(a,b)&&parseInt(b,10)>0?void 0:"Enter a positive value"},range:function(b,c){var d;return d=parseInt(c,10),a.call(b,d)<0?"Needs to be between "+b[0]+" and "+b[b.length-1]:void 0},required:function(a,b){return!a||null!=b&&""!==b?void 0:"Required"},year:function(a,b){return/^\d{4}$/.test(b)?void 0:"Enter a 4-digit year"},birthYear:function(a,b){var c;return c=this.year(a,b),c?c:parseInt(b,10)>2e3?"You must be over 18":parseInt(b,10)<1900?"Enter your birth year":void 0},month:function(a,b){return this.integer(a,b)?"Please enter a month":this.range([1,2,3,4,5,6,7,8,9,10,11,12],b)?"Needs to be between 1 and 12":void 0},choices:function(b,c){return a.call(b,c)<0?"Not an acceptable value for this field":void 0},email:function(a,b){return/^[^@<\s>]+@[^@<\s>]+$/.test(b)?void 0:"That doesn't look like an email address"},url:function(a,b){return/^https?:\/\/.+\..+/.test(b)?void 0:"Not a valid url"},usTaxID:function(a,b){return/^\d{2}-?\d{1}-?\d{2}-?\d{4}$/.test(b)?void 0:"Not a valid tax ID"},ein:function(a,b){return/^\d{2}-?\d{7}$/.test(b)?void 0:"Not a valid EIN"},ssnLast4:function(a,b){return/^\d{4}$/.test(b)?void 0:"Not a valid last 4 digits for an SSN"},ownerPersonalID:function(a,b){var c;return c=function(){switch(a){case"CA":return/^\d{3}-?\d{3}-?\d{3}$/.test(b);case"US":return!0}}(),c?void 0:"Not a valid ID"},bizTaxID:function(a,b){var c,d,e,f,g,h,i,j;if(h={CA:["Tax ID",[/^\d{9}$/]],US:["EIN",[/^\d{2}-?\d{7}$/]]},g=h[a],null!=g){for(c=g[0],f=g[1],d=!1,i=0,j=f.length;j>i;i++)if(e=f[i],e.test(b)){d=!0;break}if(!d)return"Not a valid "+c}},zip:function(a,b){var c;return c=function(){switch(a.toUpperCase()){case"CA":return/^[\d\w]{6}$/.test(null!=b?b.replace(/\s+/g,""):void 0);case"US":return/^\d{5}$/.test(b)||/^\d{9}$/.test(b)}}(),c?void 0:"Not a valid zip"},bankAccountNumber:function(a,b){return/^\d{1,17}$/.test(b)?void 0:"Invalid bank account number"},usRoutingNumber:function(a){var b,c,d,e,f,g,h;if(!/^\d{9}$/.test(a))return"Routing number must have 9 digits";for(f=0,b=g=0,h=a.length-1;h>=g;b=g+=3)c=3*parseInt(a.charAt(b),10),d=7*parseInt(a.charAt(b+1),10),e=parseInt(a.charAt(b+2),10),f+=c+d+e;return 0===f||f%10!==0?"Invalid routing number":void 0},caRoutingNumber:function(a){return/^\d{5}\-\d{3}$/.test(a)?void 0:"Invalid transit number"},routingNumber:function(a,b){switch(a.toUpperCase()){case"CA":return this.caRoutingNumber(b);case"US":return this.usRoutingNumber(b)}},phoneNumber:function(a,b){var c;return c=b.replace(/[^0-9]/g,""),10!==c.length?"Invalid phone number":void 0},bizDBA:function(a,b){return/^.{1,23}$/.test(b)?void 0:"Statement descriptors can only have up to 23 characters"},nameLength:function(a,b){return 1===b.length?"Names need to be longer than one character":void 0}}}.call(this)},{}],6:[function(a,b){function c(a){a&&g.extend(this,a)}function d(a){var b=this;return a&&(b=a),[b.address1,b.address2,b.address3,b.city,b.county].join(", ")}var e=a("../../node_modules/q/q"),f=(a("../lib/stripe.min"),a("../services/api")),g=a("../services/util"),h=a("./user"),i=a("./venue");c.prototype.getAll=function(){if(!h.isLogged())return e.reject({message:"User not logged"});var a=h.getCurrent(),b=e.defer();return f.get("users/"+a.id+"/addresses").then(function(d){a.addresses=d.map(function(a){return new c(a)}),b.resolve(a.addresses)},function(a){b.reject(a)}),b.promise},c.prototype.save=function(a){if(!h.isLogged())return e.reject({message:"User not logged"});if(!i.getCurrent())return e.reject({message:"Venue not logged"});if(!(a instanceof Object))return e.reject({message:"Incorrect addresses parameter"});a.country=a.country||"UK";var b=e.defer(),d=h.getCurrent();return g.extend(a,{userId:d.id}),f.post("users/"+d.id+"/addresses",a).then(function(a){var e=new c(a);d.addresses.push(e),b.resolve(e)},function(a){b.reject(a)}),b.promise},c.prototype.update=function(a){if(!h.isLogged())return e.reject({message:"User not logged"});if(!i.getCurrent())return e.reject({message:"Venue not logged"});if(!(a instanceof Object&&a.id))return e.reject({message:"Incorrect address parameter"});var b=e.defer(),d=h.getCurrent();return g.extend(a,{userId:d.id}),f.put("users/"+d.id+"/addresses/"+a.id,a).then(function(a){var e=new c(a);d.updateAddress(e),b.resolve(e)},function(a){b.reject(a)}),b.promise},c.prototype["delete"]=function(a){if(!h.isLogged())return e.reject({message:"User not logged"});if(!(a instanceof Object&&a.id))return e.reject({message:"Incorrect address parameter"});var b=e.defer(),c=h.getCurrent();return f["delete"]("users/"+c.id+"/addresses/"+a.id).then(function(){h.getCurrent().removeAddress(a),b.resolve()},function(a){b.reject(a)}),b.promise},c.prototype.stringify=d,c.stringify=d,b.exports=c},{"../../node_modules/q/q":1,"../lib/stripe.min":5,"../services/api":25,"../services/util":27,"./user":23,"./venue":24}],7:[function(a,b){function c(){E={total:0}}function d(){D={i:[],n:null},c()}function e(a){console.log("adding item .... ",a,v),c();var b=f(a);b?b.increment(a.item.quantity||1):D.i.push(new v({item:a.item,modifiers:a.modifiers,mealDeals:a.mealDeals}))}function f(a){var b=D.i.filter(function(b){return b.i===a.item.id}),c="",d="";a.item.isMealDeal()?(c="mealDeals",d="md"):(d="m",c="modifiers");var e=null;if(b.length)if(a[c]&&a[c].length)for(var f=a[c].map(function(a){return a instanceof w?a.i:a.id}),g=0,h=b.length;h>g;g++){var i=b[g][d].filter(function(a){return-1!==f.indexOf(a.i)});if(i.length&&i.length===f.length){e=b[g];break}}else for(var g=0,h=b.length;h>g;g++)if(!b[g][d].length){e=b[g];break}return e||!1}function g(a){var b=f(a);return b?(c(),D.i.splice(D.i.indexOf(b),1),t.resolve()):t.reject({message:"Item not found"})}function h(){for(;D.i.length>0;)D.i.pop();c()}function i(){return E&&E.total?E.total:j()}function j(){for(var a=0,b=0,c=D.i.length;c>b;b++)a+=+D.i[b].getPrice();return a}function k(a){for(var b=0,c=D.i.length-1;c>=0;c--)b=Math.max(b,D.i[c].leadTime||a);return b}function l(a){for(var b=Date.now(),c=Date.now(),d=D.i.length-1;d>=0;d--){var e=D.i[d],f=e.leadDays,g=e.leadDaysTime||0;if(f>0){var h=new Date,i=h.getDay()+1,j=z.getCloseTime(a,i);if(j){var k=j.split(":");h.setHours(k[0],k[1],0,0),h.setMinutes(h.getMinutes()-g),c>h.getTime()&&(j=!1)}if(!j)for(d=0;7>d&&(h.setDate(h.getDate()+1),!(j=z.getCloseTime(a,h.getDay()+1)));d++);h.setDate(h.getDate()+f),h.setHours(0,0,0,0),b=Math.max(b,h.getTime())}}return b}function m(a){var b=x.getCurrent();if(!b)return t.reject({message:"Venue not found"});a=a||{},b.isDelivery()&&a.orderType||(a.orderType=C.PICKUP);var c=t.defer();return u.post("orders/basket",{v:b.id,ot:a.orderType,i:D.i}).then(function(a){E=a,c.resolve(a)},function(a){c.reject(a)}),c.promise}function n(){return E?E.fees:[]}function o(){return E?E.discounts:[]}function p(){var a=x.getCurrent();if(!a)return{};var b=a.settings||{},c=i(),d=c-(E.fee||0),e=b.deliveryOrderMin||0,f=b.orderMin||0,g={total:c||0,deliveryCharge:b.deliveryCharge||0,deliveryOrderMin:e,deliveryDifference:Math.max(0,e-d),orderMin:f,orderDifference:Math.max(0,f-d)};return g}function q(){return E}function r(a){if(!(a instanceof Object))return t.reject({message:"Invalid parameter. Expected Object"});var b=null,c=null,d=null,e=null;a.deliveryState?(b=A.stringify(a.address),c=a.address.postcode,x.getCurrent().isDelivery()&&!a.orderType&&(a.orderType=C.DELIVERY)):(b=a.deliveryAddress,a.orderType||(a.orderType=a.outletLocation&&a.outletLocation.toSeatFlag?C.SEAT:C.PICKUP)),a.event?(d=a.event.schedules?a.event.schedules[0].startDate:null,e=a.event.id):d=a.pickupDay&&a.pickupTime&&a.pickupDay+"T"+a.pickupTime+":00.000",a.paymentType===B.CASH&&(a.paymentMethod=null);var f={o:a.outletId,ot:a.orderType,da:b,dp:c,i:D.i,t:j(),pm:a.paymentMethod,pt:d,e:e,ps:a.pickupSlot,n:a.notes,ptype:a.paymentType};
return y.save(f)}function s(){d()}var t=a("../../node_modules/q/q"),u=a("../services/api"),v=(a("../services/util"),a("./basketItem")),w=a("./basketModifierItem"),x=a("./venue"),y=a("./order"),z=(a("./user"),a("./hour")),A=a("./addresses"),B=a("../constants/paymentMethods"),C=a("../constants/orderType"),D={},E=null;d(),b.exports={addItem:e,removeItem:g,removeAll:h,total:i,totalCore:j,getCostDetails:p,getDiscounts:o,getFees:n,getOrderDetail:q,maxLeadTime:k,maxPickupTime:l,checkDiscount:m,processOrder:r,clear:s,getItems:function(){return D.i}}},{"../../node_modules/q/q":1,"../constants/orderType":2,"../constants/paymentMethods":3,"../services/api":25,"../services/util":27,"./addresses":6,"./basketItem":8,"./basketModifierItem":9,"./hour":11,"./order":17,"./user":23,"./venue":24}],8:[function(a,b){function c(a){a.item&&d.call(this,a)}function d(a){var b=a.item;this.i=b.id,this.plu=b.plu,this.n=b.name,this.p=b.price,this.q=b.quantity||1,this.nt=b.notes,this.m=[],this.md=[],a.modifiers&&a.modifiers.length&&e.call(this,a.modifiers),a.mealDeals&&a.mealDeals.length&&f.call(this,a.mealDeals)}function e(a){for(var b=0,c=a.length;c>b;b++)this.m.push(new i(a[b]))}function f(a){for(var b=0,d=a.length;d>b;b++)this.md.push(new c({item:a[b]}))}function g(){for(var a=0,b=this.m.length-1;b>=0;b--)a+=+this.m[b].p||0;return a}function h(){for(var a=0,b=this.md.length-1;b>=0;b--)a+=+this.md[b].p||0;return a}var i=a("./basketModifierItem");c.prototype.increment=function(a){this.q+=a},c.prototype.decrement=function(){this.q&&--this.q},c.prototype.getPrice=function(){var a=0;return this.m&&this.m.length&&(a+=g.call(this)),this.md&&this.md.length&&(a+=h.call(this)),((+a+ +this.p)*+this.q).toFixed(2)},b.exports=c},{"./basketModifierItem":9}],9:[function(a,b){function c(a){a&&d.call(this,a)}function d(a){this.i=a.id,this.n=a.name,this.p=a.price}b.exports=c},{}],10:[function(a,b){function c(a){a&&f.extend(this,a)}{var d=a("../../node_modules/q/q"),e=a("../services/api"),f=a("../services/util");a("./venue")}c.prototype.getAll=function(a,b){var f=a,g=b?"?after="+b:"";if(!f)return d.reject({message:"Venue not found"});var h=d.defer();return e.get("venues/"+f+"/events"+g).then(function(a){var b=a.map(function(a){return new c(a)});h.resolve(b)},function(a){h.reject(a)}),h.promise},c.prototype.create=function(a,b){if(!b||!b.name)return d.reject({message:"Malformed data to save."});var f=d.defer();return e.post("venues/"+a+"/events",b).then(function(a){f.resolve(new c(a))},function(a){f.reject(a)}),f.promise},c.prototype.save=function(a){if(!a||!a.name)return d.reject({message:"Malformed data to update."});var b=d.defer(),f=this.id;return e.put("events/"+f,a).then(function(a){b.resolve(new c(a))},function(a){b.reject(a)}),b.promise},c.prototype["delete"]=function(){if(!this.id)return d.reject({message:"Malformed event, did you run the constructor?"});var a=d.defer();return e["delete"]("events/"+this.id).then(function(b){a.resolve(b)},function(b){a.reject(b)}),a.promise},c.prototype.deleteSlots=function(){if(!this.id)return d.reject({message:"Malformed event, did you run the constructor?"});var a=d.defer();return e["delete"]("events/"+this.id+"/slots").then(function(b){a.resolve(b)},function(b){a.reject(b)}),a.promise},b.exports=c},{"../../node_modules/q/q":1,"../services/api":25,"../services/util":27,"./venue":24}],11:[function(a,b){function c(a){a&&k.extend(this,a)}function d(a,b){var d=l.getCurrent();return d.hours=b.map(function(a){return new c(a)}),i.resolve(b&&b instanceof Object&&b.groupBy?this.groupByDay(b):d.hours)}function e(a,b){return b=b||[h(a)],{name:f(a),value:g(a),slots:b}}function f(a){a=new Date(new Date(a).setHours(0,0,0,0));var b=new Date((new Date).setHours(0,0,0,0)),c=Math.abs(b.getTime()-a.getTime()),d=Math.ceil(c/864e5);return 0==d?"Today":1==d?"Tomorrow":a.toDateString()}function g(a){var a=[a.getFullYear(),k.pad(a.getMonth()+1),k.pad(a.getDate())].join("-");return a}function h(a){var a=[k.pad(a.getHours()),k.pad(a.getMinutes())].join(":");return a}var i=a("../../node_modules/q/q"),j=a("../services/api"),k=a("../services/util"),l=a("./venue"),m=a("./basket"),n=30,o=15;c.prototype.getAll=function(a){var b=l.getCurrent();if(!b)return i.reject({message:"Venue not found"});var c=i.defer();return j.get("venues/"+b.id+"/hours").then(function(b){d.apply(this,[a,b]).then(function(a){c.resolve(a)})},function(a){c.reject(a)}),c.promise},c.prototype.groupByDay=function(a){for(var b=[],c=0,d=0;7>d;d++){c=6>d?d+2:1;var e=a.filter(function(a){return a.day===c});b.push({day:d,hours:[]});for(var f=0,g=e.length;g>f;f++)b[d].hours.push({open:e[f].open.slice(0,5),close:e[f].close.slice(0,5)})}return b},c.prototype.getSlotTimes=function(a){if(!~["delivery","pickup"].indexOf(a))throw"Please ensure the type is either 'pickup' or 'delivery'.";var b=l.getCurrent();if(!b)throw"Venue not logged";var c=b.hours;if(c&&c.length){var d=b.settings,e=d&&d.collectInterval||o;if("pickup"==a)var f=d&&d.leadTime||n;else var f=d&&d.deliveryLeadTime||n;f=m.maxLeadTime(f);var g=m.maxPickupTime(c);return g=Math.max(g,Date.now()+60*f*1e3),this.getTimes(4,c,e,f,new Date(g),a)}},c.prototype.getTimes=function(a,b,c,d,f,g){if(!~["delivery","pickup"].indexOf(g))throw new Error("Please ensure the type is either 'pickup' or 'delivery'.");for(var h=[],i=f||new Date,j=i.getDay()+1,l=0;7>l;l++){for(var m=b.filter(function(a){return a.day===j}),n=[],o=0,p=m.length;p>o;o++){var q=m[o];if(q[g]){var r=new k.TimeRange(q.open,q.close);[].push.apply(n,r.getValues(c,d,0==l?i:!1))}}if(n.length>0&&h.push(e(i,n)),h.length==a)break;i.setDate(i.getDate()+1),j=j>6?1:j+1}return h},c.getCloseTime=function(a,b){for(var a=a.filter(function(a){return a.day==b}),c=null,d=a.length-1;d>=0;d--){var e=a[d].close;null===c?c=e:e>c&&(c=e)}return c},c.createPickup=e,b.exports=c},{"../../node_modules/q/q":1,"../services/api":25,"../services/util":27,"./basket":7,"./venue":24}],12:[function(a,b){function c(a){a&&(f.extend(this,a),d.call(this),this.mealDeal&&e.call(this))}function d(){this.modifiers=this.modifiers.map(function(a){return new g(a)})}function e(){this.mealDealSections=this.mealDealSections.map(function(a){return new h(a)})}var f=a("../services/util"),g=a("./modifier"),h=a("./mealDealSection");c.prototype.isMealDeal=function(){return 1===this.mealDeal},b.exports=c},{"../services/util":27,"./mealDealSection":13,"./modifier":15}],13:[function(a,b){function c(a){a&&d.extend(this,a)}var d=a("../services/util");b.exports=c},{"../services/util":27}],14:[function(a,b){function c(a){a&&(f.extend(this,a),d.call(this))}function d(){this.sections=this.sections.map(function(a){return new h(a)})}var e=a("../../node_modules/q/q"),f=a("../services/util"),g=a("../services/api"),h=a("./section");c.prototype.get=function(a){var b=e.defer(),d="menus?expand=true";return a.outletId?d+="&outletId="+a.outletId:a.venueId&&(d+="&venueId="+a.venueId),g.get(d).then(function(a){var d=a.map(function(a){return new c(a)});b.resolve(d)},function(a){b.reject(a)}),b.promise},b.exports=c},{"../../node_modules/q/q":1,"../services/api":25,"../services/util":27,"./section":22}],15:[function(a,b){function c(a){a&&(e.extend(this,a),d.call(this))}function d(){this.items=this.items.map(function(a){return new f(a)})}var e=a("../services/util"),f=a("./modifierItem");b.exports=c},{"../services/util":27,"./modifierItem":16}],16:[function(a,b){function c(a){a&&d.extend(this,a)}var d=a("../services/util");b.exports=c},{"../services/util":27}],17:[function(a,b){function c(a){a&&h.extend(this,a)}function d(a,b){var c=f.defer();return a.status=b,a.update().then(function(){c.resolve()},function(){c.reject()}),c.promise}function e(a){var b=i.getCurrent(),c=j.getCurrent();if(!i.isLogged())return f.reject({message:"User not logged"});if(!c)return f.reject({message:"Venue not logged"});var d=f.defer();return h.extend(a,{v:c.id,u:b.id,ph:b.phone}),g.post("orders",a).then(function(a){d.resolve(a)},function(a){d.reject(a)}),d.promise}var f=a("../../node_modules/q/q"),g=a("../services/api"),h=a("../services/util"),i=a("./user"),j=a("./venue");c.prototype.getOrdersByUser=function(){var a=i.getCurrent(),b=j.getCurrent();if(!a)return f.reject({message:"User not logged"});if(!b)return f.reject({message:"Venue not logged"});var d=f.defer();return g.get("orders?userId="+a.id+"&venueId="+b.id).then(function(a){a=a.map(function(a){return new c(a)}),d.resolve(a)},function(a){d.reject(a)}),d.promise},c.prototype.get=function(a){if(!a)return f.reject({message:"Id is required"});var b=f.defer();return g.get("orders/"+a).then(function(a){b.resolve(new c(a))},function(a){b.reject(a)}),b.promise},c.prototype.fetch=function(a){var b=f.defer(),d=h.serialize(a);return g.get("orders"+(d?"?"+d:null)).then(function(a){a=a.map(function(a){return new c(a)}),b.resolve(a)},function(a){b.reject(a)}),b.promise},c.prototype.read=function(a){var b=null;if(this.id)b=this.id;else{if(!a)return f.reject({message:"Id is required"});b=a}var c=f.defer(),d=this;return g.post("orders/"+b+"/read").then(function(){d.viewed=new Date,c.resolve()},function(a){c.reject(a)}),c.promise},c.prototype.charge=function(a){var b=null;if(this.id)b=this.id;else{if(!a)return f.reject({message:"Id is required"});b=a}var c=f.defer();return g.post("orders/"+b+"/charge").then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise},c.prototype.notify=function(a){if(!this.id)return f.reject({message:"Invalid order"});var b=f.defer();return g.post("orders/"+this.id+"/notify",{content:a}).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise},c.prototype.reject=function(a){if(!this.id)return f.reject({message:"Invalid order"});var b=f.defer();return g.post("orders/"+this.id+"/reject",{content:a}).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise},c.prototype.noShow=function(){return d(this,"NOSHOW")},c.prototype.complete=function(a){var b=null;return a?(b=new c,b.id=a):b=this,d(b,"COMPLETED")},c.prototype.preparing=function(){return d(this,"PREPARING")},c.prototype.ready=function(){return d(this,"READY")},c.prototype.delivering=function(){return d(this,"DELIVERING")},c.prototype.save=e,c.save=e,c.prototype.update=function(){i.getCurrent();if(!i.isLogged())return f.reject({message:"User not logged"});var a=f.defer();return g.put("orders/"+this.id,this).then(function(b){a.resolve(b)},function(b){a.reject(b)}),a.promise},b.exports=c},{"../../node_modules/q/q":1,"../services/api":25,"../services/util":27,"./user":23,"./venue":24}],18:[function(a,b){function c(a,b){a&&(h.extend(this,a),b&&b.length&&(j[a.id]=b.map(function(a){return new c(a,d(a.id))})))}function d(a){var b=k.filter(function(b){return b.id===a});if(b=b&&b.length&&b[0]||null,b&&b.seatStart&&b.seatEnd){for(var d=[],e=b.seatStart;e<=b.seatEnd;e++){var f=h.clone(b);f.id=b.id+"-"+e,f.name=e,d.push(new c(f))}return d}return k.filter(function(b){return b.parent===a})}function e(a,b){var e=i.getCurrent();k=a,j={};var f=null;f=b?d(b):a.filter(function(a){return!a.parent}),e.outlets=[];for(var g=0,h=f.length;h>g;g++)e.outlets.push(new c(f[g],d(f[g].id)))}var f=a("../../node_modules/q/q"),g=a("../services/api"),h=a("../services/util"),i=a("./venue"),j={},k=null;c.prototype.getAll=function(a){var b=i.getCurrent();if(!b)return f.reject({message:"Venue not found"});var c=f.defer(),d="venues/"+b.id+"/outletlocations",h=null;a instanceof Object&&a.outletLocationId&&(h=a.outletLocationId,d+="?root="+a.outletLocationId);var j=this;return g.get(d).then(function(a){e.call(j,a,h),c.resolve(b.outlets)},function(a){c.reject(a)}),c.promise},c.prototype.get=function(a){var b=f.defer(),d="outlets/"+a;return g.get(d).then(function(a){b.resolve(new c(a))},function(a){b.reject(a)}),b.promise},c.prototype.getChildrens=function(){return j[this.id]},b.exports=c},{"../../node_modules/q/q":1,"../services/api":25,"../services/util":27,"./venue":24}],19:[function(a,b){function c(a){a&&g.extend(this,a)}var d=a("../../node_modules/q/q"),e=a("../lib/stripe.min"),f=a("../services/api"),g=a("../services/util"),h=a("../services/settings"),i=a("./user"),j=a("./venue");c.prototype.getAll=function(){if(!i.isLogged())return d.reject({message:"User not logged"});var a=i.getCurrent(),b=d.defer();return f.get("users/"+a.id+"/paymentmethods").then(function(d){a.paymentMethods=d.map(function(a){return new c(a)}),b.resolve(a.paymentMethods)},function(a){b.reject(a)}),b.promise},c.prototype.validate=function(a){var b=d.defer();return e.setPublishableKey(h.getSettings().stripeKey),e.createToken(a,function(a,c){c.error?b.reject({message:c.error.message}):b.resolve({token:c.id,name:c.card.name,type:c.card.type||c.card.brand,expMonth:c.card.exp_month,expYear:c.card.exp_year,number:c.card.last4})}),b.promise},c.prototype.save=function(a){if(!i.isLogged())return d.reject({message:"User not logged"});if(!j.getCurrent())return d.reject({message:"Venue not logged"});if(!(a instanceof Object))return d.reject({message:"Incorrect Payment Method parameter"});var b=d.defer(),e=i.getCurrent();return this.validate(a).then(function(a){angular.extend(a,{userId:e.id,venueId:j.getCurrent().id}),f.post("users/"+e.id+"/paymentmethods",a).then(function(a){var d=new c(a);e.paymentMethods.push(d),b.resolve(d)},function(a){b.reject(a)})},function(a){b.reject(a)}),b.promise},c.prototype["delete"]=function(a){if(!i.isLogged())return d.reject({message:"User not logged"});if(!(a instanceof Object&&a.id))return d.reject({message:"Incorrect Payment Method parameter"});var b=d.defer(),c=i.getCurrent();return f["delete"]("users/"+c.id+"/paymentmethods/"+a.id).then(function(){i.getCurrent().removePaymentMethod(a),b.resolve()},function(a){b.reject(a)}),b.promise},b.exports=c},{"../../node_modules/q/q":1,"../lib/stripe.min":5,"../services/api":25,"../services/settings":26,"../services/util":27,"./user":23,"./venue":24}],20:[function(a,b){function c(a){a&&f.extend(this,a)}var d=a("../../node_modules/q/q"),e=a("../services/api"),f=a("../services/util"),g=a("./venue");c.prototype.getPaymentProvidersByVenue=function(){var a=g.getCurrent();if(!a)return d.reject({message:"Venue not found"});var b=d.defer();return e.get("venues/"+a.id+"/paymentproviders").then(function(d){a.paymentProviders=d.map(function(a){return new c(a)}),b.resolve(a.paymentProviders)},function(a){b.reject(a)}),b.promise},b.exports=c},{"../../node_modules/q/q":1,"../services/api":25,"../services/util":27,"./venue":24}],21:[function(a,b){function c(a){a&&f.extend(this,a)}var d=a("../../node_modules/q/q"),e=a("../services/api"),f=a("../services/util");c.prototype.getAll=function(a){if(!a||!a.id)return d.reject({message:"Invalid event param"});var b=d.defer();return e.get("events/"+a.id+"/slots/slotConfig").then(function(a){var a=a.map(function(a){return new c(a)});b.resolve(a)},function(a){b.reject(a)}),b.promise},c.prototype.create=function(a){if(!a||!a.name||!a.eventId)return d.reject({message:"Malformed pickup slot, did you run the constructor?"});var b=d.defer();return e.post("events/"+a.eventId+"/slots",a).then(function(a){b.resolve(new c(a))},function(a){b.reject(a)}),b.promise},c.prototype.save=function(){if(void 0==this.id||void 0==this.eventId)return d.reject({message:"Malformed pickup slot, did you run the constructor?"});var a=d.defer();return e.put("events/"+this.eventId+"/slots/"+this.id,this).then(function(b){var b=b.map(function(a){return new c(a)});a.resolve(b)},function(b){a.reject(b)}),a.promise},c.prototype["delete"]=function(){this.id?"post":"put";if(!this.name||!this.eventId)return d.reject({message:"Malformed pickup slot, did you run the constructor?"});var a=d.defer();return this.id?e["delete"]("events/"+this.eventId+"/slots/"+this.id).then(function(b){var b=b.map(function(a){return new c(a)});a.resolve(b)},function(b){a.reject(b)}):a.resolve({message:"No slots to delete"}),a.promise},b.exports=c},{"../../node_modules/q/q":1,"../services/api":25,"../services/util":27}],22:[function(a,b){function c(a){a&&(e.extend(this,a),d.call(this))}function d(){this.items=this.items.map(function(a){return new f(a)})}var e=a("../services/util"),f=a("./item");b.exports=c},{"../services/util":27,"./item":12}],23:[function(a,b){function c(a){a&&(j.extend(this,a),d.call(this),e.call(this))}function d(){if(this.addresses){var b=a("./addresses");this.addresses=this.addresses.map(function(a){return new b(a)})}}function e(){if(this.paymentMethods){var b=a("./paymentMethod");this.paymentMethods=this.paymentMethods.map(function(a){return new b(a)})}}function f(){return k}function g(){return null!==k}var h=a("../../node_modules/q/q"),i=a("../services/api"),j=a("../services/util"),k=null;c.prototype.auth=function(a){if(!a)return h.reject({message:"Username and password is required"});if(!a.username)return h.reject({message:"Username is required"});if(!a.password)return h.reject({message:"Password is required"});var b=h.defer();return i.post("users/auth",{username:a.username,password:a.password}).then(function(a){k=new c(a),b.resolve(k)},function(a){b.reject(a)}),b.promise},c.prototype.forgotPassword=function(a){if(!a.email)return h.reject({message:"Email is required"});var b=h.defer();return i.post("users/auth/forgot",a).then(function(){b.resolve()},function(a){b.reject(a)}),b.promise},c.prototype.isAdmin=function(){var a=h.defer();return i.get("users/auth/roles/admin").then(function(){a.resolve()},function(b){a.reject(b)}),a.promise},c.prototype.save=function(a){if(c.isLogged())return h.reject({message:"User already logged"});if(!a.firstName)return h.reject({message:"First name is required"});if(!a.lastName)return h.reject({message:"Last name is required"});if(!a.email)return h.reject({message:"Email is required"});if(!a.password)return h.reject({message:"Password is required"});var b=h.defer();return i.post("users",a).then(function(a){k=new c(a),b.resolve(k)},function(a){b.reject(a)}),b.promise},c.prototype.update=function(a){if(!c.isLogged())return h.reject({message:"User not logged"});if(!a.firstName)return h.reject({message:"First name is required"});if(!a.lastName)return h.reject({message:"Last name is required"});if(!a.email)return h.reject({message:"Email is required"});var b=c.getCurrent(),d=h.defer();return i.patch("users/"+b.id,{firstName:a.firstName,lastName:a.lastName,email:a.email,phone:a.phone}).then(function(a){a.token=b.token,k=new c(a),d.resolve(k)},function(a){d.reject(a)}),d.promise},c.getCurrent=f,c.prototype.getCurrent=f,c.isLogged=g,c.prototype.isLogged=g,c.prototype.setUser=function(a){k=a},c.prototype.removePaymentMethod=function(a){var b=this.paymentMethods.map(function(a){return a.id}).indexOf(a.id);this.paymentMethods.splice(b,1)},c.prototype.updateAddress=function(a){var b=this.addresses.map(function(a){return a.id}).indexOf(a.id);this.addresses[b]=a},c.prototype.removeAddress=function(a){var b=this.addresses.map(function(a){return a.id}).indexOf(a.id);this.addresses.splice(b,1)},b.exports=c},{"../../node_modules/q/q":1,"../services/api":25,"../services/util":27,"./addresses":6,"./paymentMethod":19}],24:[function(a,b){function c(a){a&&f.extend(this,a)}var d=a("../../node_modules/q/q"),e=a("../services/api"),f=a("../services/util"),g=null;c.prototype.get=function(a){if(!a)return d.reject({message:"Venue identifier is required"});var b=d.defer();return this.fetch(a).then(function(a){g=a[0],b.resolve(a[0])},function(a){b.reject(a)}),b.promise},c.prototype.fetch=function(a){var b=d.defer(),g="venues",h="settings,hours";return a.venueId||a.permalink&&(delete a.venueId,g+="/permalink"),a.expand&&(h+=","+a.expand,delete a.expand),g+="?expand="+h+"&"+f.serialize(a),e.get(g).then(function(a){void 0===a.length&&(a=[a]);var d=a.map(function(a){return new c(a)});b.resolve(d)},function(a){b.reject(a)}),b.promise},c.prototype.getMessages=function(a){var b=null;if(this.id)b=this.id;else{if(!a)return d.reject({message:"Id is required"});b=a}var c=d.defer();return e.get("venues/"+b+"/messages").then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise},c.prototype.getHours=function(){return g=this,Preoday.Hour.getAll()},c.prototype.getPaymentProviders=function(){return g=this,Preoday.PaymentProvider.getPaymentProvidersByVenue()},c.getCurrent=function(){return g},c.prototype.isEvent=function(){return this.eventFlag},c.prototype.isDelivery=function(){return this.deliverFlag},c.prototype.isPickup=function(){return this.pickupFlag},c.prototype.isCashPaymentEnable=function(){return this.paymentProviders&&this.paymentProviders.filter(function(a){return"CASH"===a.type}).length},c.prototype.isCardPaymentEnable=function(){return this.paymentProviders&&this.paymentProviders.filter(function(a){return"Stripe"===a.type}).length},b.exports=c},{"../../node_modules/q/q":1,"../services/api":25,"../services/util":27}],25:[function(a,b){function c(a){var b=i.defer();return j.get(k+a).success(function(a){b.resolve(a)}).error(function(a){b.reject(a)}),b.promise}function d(a,b){var c=i.defer();return j.post(k+a,b).success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise}function e(a,b){var c=i.defer();return j.put(k+a,b).success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise}function f(a,b){var c=i.defer();return j.patch(k+a,b).success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise}function g(a){var b=i.defer();return j["delete"](k+a).success(function(a){b.resolve(a)}).error(function(a){b.reject(a)}),b.promise}function h(a){return a instanceof Object&&(l=a),l}var i=a("../../node_modules/q/q"),j=new(a("../lib/atomic"))(window),k=(a("./util"),"/api/"),l={};b.exports={get:c,post:d,put:e,patch:f,headers:h,"delete":g,setUrlBase:function(a){k=a}},function(b){var c=function(a){for(var b in a)if(a.hasOwnProperty(b))if("$"===b.charAt(0))a[b]=void 0;else if(null!=a[b])if(a[b]instanceof Object)c(a[b]);else if(a[b].constructor==Array)for(var d=0;d<a[b].length;d++)c(a[b][d])};XMLHttpRequest.prototype.send=function(d){var e=(a("../modules/user"),a("../modules/venue"));for(var f in l)l.hasOwnProperty(f)&&this.setRequestHeader(f,l[f]);d instanceof Object&&c(d);var g=e.getCurrent();g&&this.setRequestHeader("preo-venueid",g.id),b.call(this,JSON.stringify(d))}}(XMLHttpRequest.prototype.send)},{"../../node_modules/q/q":1,"../lib/atomic":4,"../modules/user":23,"../modules/venue":24,"./util":27}],26:[function(a,b){function c(){var a=d.defer();return e.get("config/app").then(function(b){f=b,a.resolve()},function(b){a.reject(b)}),a.promise}var d=a("../../node_modules/q/q"),e=a("./api"),f=(a("./util"),null);b.exports={loadConfig:c,getSettings:function(){return f}}},{"../../node_modules/q/q":1,"./api":25,"./util":27}],27:[function(a,b){function c(a){return 10>a?"0"+a:a}a("../../node_modules/q/q");b.exports={extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},pad:c,TimeRange:function(a,b){this.start=a,this.end=b.replace(/^00:00/,"23:59");var d=this.start.split(":"),e=this.end.split(":");this.getValues=function(a,b,f){console.log("start here",f);var g=[],h=new Date;h.setHours(parseInt(d[0],10)),h.setMinutes(parseInt(d[1],10)+b);var i=new Date;i.setHours(parseInt(e[0],10)),i.setMinutes(parseInt(e[1],10)),i.setDate(h.getDate());var j=i.getTime();if(h.getTime()<j)for(;h.getTime()<=j;)(!f||h.getTime()>=f.getTime())&&g.push(c(h.getHours())+":"+c(h.getMinutes())),h.setMinutes(h.getMinutes()+a);return g}},serialize:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},clone:function(a){return JSON.parse(JSON.stringify(a))}}},{"../../node_modules/q/q":1}],28:[function(a,b){function c(){j=!1,g.length?i=g.concat(i):k=-1,i.length&&d()}function d(){if(!j){var a=setTimeout(c);j=!0;for(var b=i.length;b;){for(g=i,i=[];++k<b;)g[k].run();k=-1,b=i.length}g=null,j=!1,clearTimeout(a)}}function e(a,b){this.fun=a,this.array=b}function f(){}var g,h=b.exports={},i=[],j=!1,k=-1;h.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];i.push(new e(a,b)),1!==i.length||j||setTimeout(d,0)},e.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=f,h.addListener=f,h.once=f,h.off=f,h.removeListener=f,h.removeAllListeners=f,h.emit=f,h.binding=function(){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],29:[function(a){window.Preoday={Menu:new(a("./modules/menu")),Venue:new(a("./modules/venue")),Event:new(a("./modules/event")),PickupSlot:new(a("./modules/pickupSlot")),Outlet:new(a("./modules/outlet")),Hour:new(a("./modules/hour")),User:new(a("./modules/user")),PaymentMethod:new(a("./modules/paymentMethod")),PaymentProvider:new(a("./modules/paymentProvider")),Addresses:new(a("./modules/addresses")),Order:new(a("./modules/order")),Api:a("./services/api"),Basket:a("./modules/basket")};var b=a("./services/settings");b.loadConfig()},{"./modules/addresses":6,"./modules/basket":7,"./modules/event":10,"./modules/hour":11,"./modules/menu":14,"./modules/order":17,"./modules/outlet":18,"./modules/paymentMethod":19,"./modules/paymentProvider":20,"./modules/pickupSlot":21,"./modules/user":23,"./modules/venue":24,"./services/api":25,"./services/settings":26}]},{},[29]);var app=angular.module("events",["ngRoute","constants","webapp.components"]).config(["$routeProvider",function(a){console.log("prividing route"),a.when("/",{templateUrl:"/code/events/partials/events.php"}).otherwise({redirectTo:"/"})}]);!function(a,b){b.module("events").controller("EventsCtrl",["$scope","$rootScope","$timeout","$q","VENUE_ID","Events","CollectionSlots",function(c,d,e,f,g,h,i){function j(){k(),p()}function k(){var a=864e5,b=new Date,c=14,d=new Date(b.getTime()-a*c),g=d.getFullYear()+"/"+(d.getMonth()+1)+"/"+d.getDate();h.get(g).then(function(a){console.log(a);var b=a||[],c=[];b.forEach(function(a){var b=a.schedules,d=f.defer();b.length>0&&(a.date=b[0].startDate,a.starttime=o(b[0].startDate),a.endtime=o(b[0].endDate)),i.get(a).then(function(b){console.log(b);var c=b||[];a.cSlots=[],console.log(c),0==c.length?a.cSlots.push({end:"",eventId:"",leadTime:"",name:"",start:"",step:""}):c.forEach(function(b,c){a.cSlots.push(b),a.collectionCount=c}),d.resolve()},function(a){console.error("Error getting slots from API: "+a.data.message),d.resolve(a.data)}),c.push(d.promise)}),f.all(c).then(function(){w.events=b,e(function(){$(".eventTDDate input").fdatepicker({format:"dd/mm/yyyy"}),$(".eventTDTime input").timepicker({showDuration:!0,timeFormat:"H:i",step:15}),$(".eventTDTime input").timepicker({showDuration:!0,timeFormat:"H:i",step:15}),$("input[name^=eTime]").on("changeTime",function(){currTime=$(this).val()+":00",newTime=extractAMPM("January 01, 2000 "+currTime),$(this).parents("table").find("input[name^=eETime]").timepicker("remove"),$(this).parents("table").find("input[name^=eETime]").timepicker({showDuration:!0,timeFormat:"H:i",step:15}),$(this).parents("table").find("input[name^=eETime]").timepicker({minTime:newTime,timeFormat:"H:i",step:15}),$(this).parents("table").find("input[name^=eETime]").timepicker("setTime",newTime)})},0),w.redirectFlag=0,w.event_edit_on=1})},function(a){console.error(a),console.error("Error getting events from API:"+a.message),w.redirectFlag=1,w.event_edit_on=0})}function l(a){var b=null,c={venueId:g,name:a.name,description:a.description,visible:a.visible||1};if(-1!=a.date.indexOf("/")){var d=a.date.split("/");b=new Date(d[2],d[1]-1,d[0])}else b=new Date(a.date);var e=b.getUTCFullYear(),f=b.getUTCMonth(),h=b.getUTCDate(),i=a.starttime.split(":"),j=a.endtime.split(":"),k=new Date(e,f,h,i[0],i[1]),l=new Date(e,f,h,j[0],j[1]);return a.hasOwnProperty("outletLocationId")&&"undefined"!==a.outletLocationId&&(c.outletLocationId=a.outletLocationId),c.duration=m(k.getTime(),l.getTime()),c.schedules=[{freq:"ONCE",startDate:e+"-"+pad(String(Number(f)+1),2)+"-"+pad(String(h),2)+"T"+a.starttime+":00",endDate:e+"-"+pad(String(Number(f)+1),2)+"-"+pad(String(h),2)+"T"+a.endtime+":00"}],c}function m(a,b){var c=b-a,d=Math.round(c/6e4);return d}function n(a,b,c){a.deleteSlots().then(function(){var d=[];console.log("event id "+a.id),console.log(b),b.cSlots.length>0?(b.cSlots.forEach(function(b){b.eventId=a.id,d.push(i.create(b))}),f.all(d).then(c.resolve)):c.resolve()},function(a){console.log(a),c.reject(a)})}function o(a){var b=new Date(a),c=a?pad(b.getUTCHours(),2)+":"+pad(b.getUTCMinutes(),2):"";return c}function p(){h.getOutletLocations().then(function(a){var b=a.data,c=s(b);w.outletLocations=t(c)})}function q(a,b){var c=[];return a.forEach(function(d){d.parent==b.id&&d.id!=d.parent&&(d.children=q(a,d),c.push(d))}),c}function r(a){return a.forEach(function(b,c){0==b.children.length?a.splice(c,1):b.children=r(b.children)}),a}function s(a){a.sort(a,function(a,b){return a.path<b.path});var b=[];return a.forEach(function(c){null==c.parent&&null!=c.id&&(c.children=q(a,c),b.push(c))}),r(b)}function t(a){var b=[];return a.forEach(function(a){u(a,1,b)}),b}function u(a,b,c){var d=a.children,e={id:a.id,name:v("--",b)+" "+a.name};c.push(e),d.forEach(function(a){u(a,b+1,c)})}function v(a,b){for(var c="";;){if(1&b&&(c+=a),b>>=1,!b)break;a+=a}return c}var w=this,x=0;w.addEvent=function(){var b={cSlots:[{end:"",eventId:"",leadTime:"",name:"",start:"",step:""}]};w.events.push(b),e(function(){$(".eventTDEdit").last().click();var b=$(".eventTable").last();b.find(".eventTDDate input").fdatepicker({format:"dd/mm/yyyy",onRender:function(a){return a.valueOf()<now.valueOf()?"disabled":""}}),b.find("input[name^=eTime]").timepicker({showDuration:!0,timeFormat:"H:i",step:15}),b.find("input[name^=eETime]").timepicker({showDuration:!0,timeFormat:"H:i",step:15}),b.find("input[name^=eTime]").on("changeTime",function(){currTime=$(this).val()+":00",newTime=extractAMPM("January 01, 2000 "+currTime),$(this).parents("table").find("input[name^=eETime]").timepicker("remove"),$(this).parents("table").find("input[name^=eETime]").timepicker({showDuration:!0,timeFormat:"H:i",step:15}),$(this).parents("table").find("input[name^=eETime]").timepicker({minTime:newTime,timeFormat:"H:i",step:15}),$(this).parents("table").find("input[name^=eETime]").timepicker("setTime",newTime)}),b.css("backgroundColor","#fafafa"),b.css("box-shadow","rgba(70, 83, 93, 0.54902) 0px 0px 6px inset"),b.css("max-width","100%"),b.find(".eventSave").is(":visible")||b.find(".eventTDEdit").trigger("click"),$("html, body").animate({scrollTop:$(b).offset().top-($(a).height()-$(b).outerHeight(!0))/2},200)},0)},w.save=function(){var a=(new Date).getTime();if(a-x>300){w.isSaving=!0;var c=[];w.events.forEach(function(a){var d=l(b.copy(a)),e=f.defer();console.log(a),a.id&&!String(a.id).match("/^e.*$/")?(console.log(a),h.update(a,d).then(function(b){console.log(b),n(b,a,e)},function(a){console.error("Error saving event. "),console.log(a),e.resolve(a)})):h.create(d).then(function(b){console.log(b),n(b,a,e)},function(a){console.error("Error saving event. "),console.log(a),e.resolve(a)}),c.push(e.promise)}),f.all(c).then(function(){w.isSaving=!1},function(){w.isSaving=!1}),x=(new Date).getTime()}},a.pad=function(a,b){return a=a.toString(),a.length<b?pad("0"+a,b):a},d.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)},j()}])}(window,angular),angular.module("events").directive("slot",["$timeout",function(a){return{templateUrl:"/code/events/js/directives/slot/slot.php",restrict:"A",replace:!0,scope:{slots:"=elements",event_index:"=countevent"},link:function(b,c){b.add=function(){var d={end:"",eventId:"",leadTime:"",name:"",start:"",step:""};b.slots.push(d),a(function(){var e=$(c.context.parentElement).find("select").last(),f=$(c.context.parentElement).find(".eventTDCollection .slotName").last();a(function(){e.multiselect({multiple:!1,header:!1,noneSelectedText:_tr("Choose a Collection Slot"),selectedList:1,minWidth:342}),console.log(f),f.autocomplete({source:[_tr("Collection Slot: Pre-Show"),_tr("Collection Slot: Pre-Game"),_tr("Collection Slot: Interval"),_tr("Collection Slot: Second-Interval"),_tr("Collection Slot: Half-Time"),_tr("Collection Slot: Post-Show"),_tr("Collection Slot: Post-Game")],delay:10,minLength:0,select:function(a,c){d.name=c.item.value,b.$apply()
},position:{my:"left top",at:"left bottom",collision:"none",of:f}})},0),$(c.context.parentElement).find(".optionTR").last().slideRow("down").addClass("eventEdit").removeClass("savedInput"),$("html, body").animate({scrollTop:e.closest("tr").offset().top-($(window).height()-e.closest("tr").outerHeight(!0))/2},200)},0)},b["delete"]=function(a){b.slots.some(function(c,d){return a==c?(b.slots.splice(d,1),!0):!1})}}}}]),angular.module("events").directive("event",["$timeout","$q","$rootScope","Events",function(a,b,c,d){return{templateUrl:"/code/events/js/directives/event/event.php",restrict:"E",replace:!0,scope:{events:"=elements",outletLocations:"=outlet"},link:function(b){function e(a){c.safeApply(function(){b.events.some(function(c,d){return c==a?(b.events.splice(d,1),!0):!1})})}b.expandOptions=function(a,c){var d=$(a.currentTarget).closest("table"),e=$(a.currentTarget).hasClass("eventTDEdit");($(a.currentTarget).attr("readonly")||e)&&(e?$(a.currentTarget).hide():$(a.currentTarget).closest("table").find(".eventTDEdit").hide(),d.find("tr").addClass("eventEdit"),d.find("tr").removeClass("savedInput"),d.find("input").removeAttr("readonly"),d.find(".eventSave").removeClass("hide"),d.find(".eventSave").show(),d.find(".optionTR").slideRow("down"),d.css("background","#fafafa"),d.css("box-shadow","rgba(70, 83, 93, 0.54902) 0px 0px 6px inset"),d.css("max-width","100%"),d.find(".eventTDCollection .slotName").autocomplete({source:[_tr("Collection Slot: Pre-Show"),_tr("Collection Slot: Pre-Game"),_tr("Collection Slot: Interval"),_tr("Collection Slot: Second-Interval"),_tr("Collection Slot: Half-Time"),_tr("Collection Slot: Post-Show"),_tr("Collection Slot: Post-Game")],delay:10,minLength:0,select:function(a,d){c.cSlots[a.target.parentElement.parentElement.rowIndex-2].name=d.item.value,b.$apply()},position:{my:"left top",at:"left bottom",collision:"none",of:d.find(".eventTDCollection .slotName")}}),d.find("td.eventTDOutletLocation select").multiselect({multiple:!1,header:!1,noneSelectedText:_tr("Choose Event Location"),selectedList:1,minWidth:342}))},b.collapseOptions=function(a){var b=$(a.currentTarget),c=b.closest("table");b.hide(),c.find("tr").removeClass("eventEdit"),c.find("tr").addClass("savedInput"),c.find("input").attr("readonly","readonly"),c.find(".eventTDEdit").removeClass("hide"),c.find(".eventTDEdit").show(),c.find(".optionTR").slideRow("up"),c.css("background","transparent"),c.css("box-shadow","0px 0px 0px"),c.css("max-width","100%")},b.duplicate=function(c){var d=angular.copy(c);d.id="",b.events.push(d),a(function(){$(".eventTDEdit").last().click();var a=$(".eventTable").last();a.find(".eventTDDate input").fdatepicker({format:"dd/mm/yyyy",onRender:function(a){return a.valueOf()<now.valueOf()?"disabled":""}}),a.find("input[name^=eTime]").timepicker({showDuration:!0,timeFormat:"H:i",step:15}),a.find("input[name^=eETime]").timepicker({showDuration:!0,timeFormat:"H:i",step:15}),a.css("backgroundColor","#fafafa"),a.css("box-shadow","rgba(70, 83, 93, 0.54902) 0px 0px 6px inset"),a.css("max-width","100%"),a.find(".eventSave").is(":visible")||a.find(".eventTDEdit").trigger("click"),$("html, body").animate({scrollTop:$(a).offset().top-($(window).height()-$(a).outerHeight(!0))/2},200)},0)},b["delete"]=function(a){var b=a.id;console.log(b),noty("undefined"!=typeof b&&""!=b&&String(b).match(/^\d+?$/gi)?{layout:"center",type:"confirm",text:_tr("Are you sure you want to delete this event? Note: all event data will be lost!"),buttons:[{addClass:"alert tiny",text:_tr("Yes, delete this event!"),onClick:function(b){console.log("Make api request..."),d.deleteEvent(a).then(function(){console.log(arguments),e(a)},function(){noty({type:"error",layout:"topCenter",text:_tr("Sorry, but there's been an error processing your request.")})}),b.close()}},{addClass:"secondary tiny",text:_tr("No, go back."),onClick:function(a){a.close()}}]}:{layout:"center",type:"confirm",text:_tr("Are you sure you want to delete this event? Note: all event data will be lost!"),buttons:[{addClass:"alert tiny",text:_tr("Yes, delete this event!"),onClick:function(b){e(a),b.close()}},{addClass:"secondary tiny",text:_tr("No, go back."),onClick:function(a){a.close()}}]})},b.formatDate=function(a){var b=new Date(a),c=a?pad(String(b.getUTCDate()),2)+"/"+pad(String(b.getUTCMonth()+1),2)+"/"+b.getUTCFullYear():"";return c}}}}]),function(a,b){b.module("events").service("CollectionSlots",["$http","$q","VENUE_ID",function(a,b,c){var d={};return d.get=function(a){return Preoday.PickupSlot.getAll(a)},d.create=function(a){return Preoday.PickupSlot.create(a)},d.update=function(a){return a.save()},d["delete"]=function(a){return a["delete"]()},d}])}(window,angular),function(a,b){b.module("events").service("Events",["$http","$q","VENUE_ID",function(a,b,c){var d={},e=c;return d.get=function(a){return Preoday.Event.getAll(e,a)},d.deleteEvent=function(a){function c(a,b){a["delete"]().then(function(a){console.log("deleted all"),console.log(b),b.resolve(a)},function(a){b.reject(a)})}var d=b.defer();return a.cSlots.length>0?a.deleteSlots().then(function(){c(a,d)},function(a){d.reject(a)}):c(a,d),d.promise},d.update=function(a,b){return console.log(a,b),a.save(b)},d.create=function(a){return Preoday.Event.create(e,a)},d.getOutletLocations=function(){return a.get("/api/venues/"+e+"/outletlocations?outlets=false")},d}])}(window,angular),angular.module("notification",["ngSanitize"]).controller("confirmModalController",["$scope","$modalInstance","data","deffered","$http","$templateCache","$compile","$sce","$timeout","AccountFeature","ACCOUNT_ID","VENUE_ID","USER_ID",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n="/code/notification/templates/";if(a.title=c.title||"",a.discountCode="",a.appliedDiscount=!1,c.hasOwnProperty("templateFullUrl")&&c.templateFullUrl)angular.extend(a,c.scope);else if(c.hasOwnProperty("templateUrl")&&c.templateUrl){a.templateUrl=c.templateUrl;var o=function(b){i(function(){angular.element("#contentPartial").html(g(b)(a))})},p=f.get(n+c.templateUrl);p?o(p):e.get(n+c.templateUrl).then(function(a){f.put(n+c.templateUrl,a.data),o(a.data)})}else a.content=c.content||"";c.hasOwnProperty("scope")&&c.scope&&(a=angular.extend(a,c.scope)),a.toTrusted=function(a){return h.trustAsHtml(a||"")},a.showTerm=c.showTerm||!1,a.acceptTerm=!1,a.contentClass=c.contentClass||"",a.modifyPositionButtons=c.modifyPositionButtons||!1,a.btnOk=c.btnOk===!1?!1:c.btnOk||_tr("OK"),c.btnCancel===!1?c.btnCancel=!1:a.btnCancel=c.btnCancel||_tr("CANCEL"),a.changeTerm=function(b){a.acceptTerm=b},a.send=function(){b.close();var c={acceptTerm:a.acceptTerm};a.appliedDiscount&&(c.discountCode=a.discountCode),d.resolve(c)},a.cancel=function(){b.close(),d.reject({acceptTerm:a.acceptTerm})},a.validateDiscountCode=function(){a.errorMsg="",a.discountCode||(a.errorMsg=_tr("Please enter a discount code")),j.getPrice({accountId:k,featureId:a.featureId,code:a.discountCode.toUpperCase(),venueId:l,userId:m},function(b){angular.extend(a,b),a.appliedDiscount=!0},function(b){400===b.status&&b.data&&(a.errorMsg=b.data.message)})}}]).service("$notification",["$modal","$q","$sce",function(a,b){var c="/code/notification/templates/",d=function(d){var e=b.defer();d=d||{},d.hasOwnProperty("templateFullUrl")&&d.templateFullUrl&&(d.templateFullUrl=c+d.templateFullUrl);var f=a.open({templateUrl:d.templateFullUrl||"/code/notification/notification.php",windowClass:"modal-preoday "+(d.windowClass||""),controller:"confirmModalController",resolve:{data:function(){return d},deffered:function(){return e}}});return f.opened.then(function(){setTimeout(function(){$(".modal-preoday").addClass("active")},400)}),e.promise};return{confirm:d}}]);