"use strict";!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(a){!function(a){if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof c&&"object"==typeof b)b.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");var d="undefined"!=typeof window?window:self,e=d.Q;d.Q=a(),d.Q.noConflict=function(){return d.Q=e,this}}}(function(){function b(a){return function(){return X.apply(a,arguments)}}function c(a){return a===Object(a)}function d(a){return"[object StopIteration]"===da(a)||a instanceof T}function e(a,b){if(Q&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(ea)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var e=c.join("\n"+ea+"\n");a.stack=f(e)}}function f(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];i(e)||g(e)||!e||c.push(e)}return c.join("\n")}function g(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function h(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function i(a){var b=h(a);if(!b)return!1;var c=b[0],d=b[1];return c===S&&d>=U&&ja>=d}function j(){if(Q)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=h(c);if(!d)return;return S=d[0],d[1]}}function k(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",new Error("").stack),a.apply(a,arguments)}}function l(a){return a instanceof p?a:t(a)?C(a):B(a)}function m(){function a(a){b=a,f.source=a,Z(c,function(b,c){l.nextTick(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=aa(m.prototype),f=aa(p.prototype);if(f.promiseDispatch=function(a,e,f){var g=Y(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):l.nextTick(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){if(c)return f;var a=r(b);return s(a)&&(b=a),a},f.inspect=function(){return b?b.inspect():{state:"pending"}},l.longStackSupport&&Q)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(c){b||a(l(c))},e.fulfill=function(c){b||a(B(c))},e.reject=function(c){b||a(A(c))},e.notify=function(a){b||Z(d,function(b,c){l.nextTick(function(){c(a)})},void 0)},e}function n(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=m();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function o(a){return n(function(b,c){for(var d=0,e=a.length;e>d;d++)l(a[d]).then(b,c)})}function p(a,b,c){void 0===b&&(b=function(a){return A(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=aa(p.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=A(h)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function q(a,b,c,d){return l(a).then(b,c,d)}function r(a){if(s(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function s(a){return a instanceof p}function t(a){return c(a)&&"function"==typeof a.then}function u(a){return s(a)&&"pending"===a.inspect().state}function v(a){return!s(a)||"fulfilled"===a.inspect().state}function w(a){return s(a)&&"rejected"===a.inspect().state}function x(){fa.length=0,ga.length=0,ia||(ia=!0)}function y(b,c){ia&&("object"==typeof a&&"function"==typeof a.emit&&l.nextTick.runAfter(function(){-1!==$(ga,b)&&(a.emit("unhandledRejection",c,b),ha.push(b))}),ga.push(b),c&&"undefined"!=typeof c.stack?fa.push(c.stack):fa.push("(no stack) "+c))}function z(b){if(ia){var c=$(ga,b);-1!==c&&("object"==typeof a&&"function"==typeof a.emit&&l.nextTick.runAfter(function(){var d=$(ha,b);-1!==d&&(a.emit("rejectionHandled",fa[c],b),ha.splice(d,1))}),ga.splice(c,1),fa.splice(c,1))}}function A(a){var b=p({when:function(b){return b&&z(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return y(b,a),b}function B(a){return p({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return ca(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function C(a){var b=m();return l.nextTick(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function D(a){return p({isDef:function(){}},function(b,c){return J(a,b,c)},function(){return l(a).inspect()})}function E(a,b,c){return l(a).spread(b,c)}function F(a){return function(){function b(a,b){var g;if("undefined"==typeof StopIteration){try{g=c[a](b)}catch(h){return A(h)}return g.done?l(g.value):q(g.value,e,f)}try{g=c[a](b)}catch(h){return d(h)?l(h.value):A(h)}return q(g,e,f)}var c=a.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}}function G(a){l.done(l.async(a)())}function H(a){throw new T(a)}function I(a){return function(){return E([this,K(arguments)],function(b,c){return a.apply(b,c)})}}function J(a,b,c){return l(a).dispatch(b,c)}function K(a){return q(a,function(a){var b=0,c=m();return Z(a,function(d,e,f){var g;s(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,q(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function L(a){if(0===a.length)return l.resolve();var b=l.defer(),c=0;return Z(a,function(d,e,f){function g(a){b.resolve(a)}function h(){c--,0===c&&b.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function i(a){b.notify({index:f,value:a})}var j=a[f];c++,q(j,g,h,i)},void 0),b.promise}function M(a){return q(a,function(a){return a=_(a,l),q(K(_(a,function(a){return q(a,V,V)})),function(){return a})})}function N(a){return l(a).allSettled()}function O(a,b){return l(a).then(void 0,void 0,b)}function P(a,b){return l(a).nodeify(b)}var Q=!1;try{throw new Error}catch(R){Q=!!R.stack}var S,T,U=j(),V=function(){},W=function(){function b(){for(var a,b;d.next;)d=d.next,a=d.task,d.task=void 0,b=d.domain,b&&(d.domain=void 0,b.enter()),c(a,b);for(;i.length;)a=i.pop(),c(a);f=!1}function c(a,c){try{a()}catch(d){if(h)throw c&&c.exit(),setTimeout(b,0),c&&c.enter(),d;setTimeout(function(){throw d},0)}c&&c.exit()}var d={task:void 0,next:null},e=d,f=!1,g=void 0,h=!1,i=[];if(W=function(b){e=e.next={task:b,domain:h&&a.domain,next:null},f||(f=!0,g())},"object"==typeof a&&"[object process]"===a.toString()&&a.nextTick)h=!0,g=function(){a.nextTick(b)};else if("function"==typeof setImmediate)g="undefined"!=typeof window?setImmediate.bind(window,b):function(){setImmediate(b)};else if("undefined"!=typeof MessageChannel){var j=new MessageChannel;j.port1.onmessage=function(){g=k,j.port1.onmessage=b,b()};var k=function(){j.port2.postMessage(0)};g=function(){setTimeout(b,0),k()}}else g=function(){setTimeout(b,0)};return W.runAfter=function(a){i.push(a),f||(f=!0,g())},W}(),X=Function.call,Y=b(Array.prototype.slice),Z=b(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),$=b(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),_=b(Array.prototype.map||function(a,b){var c=this,d=[];return Z(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),aa=Object.create||function(a){function b(){}return b.prototype=a,new b},ba=b(Object.prototype.hasOwnProperty),ca=Object.keys||function(a){var b=[];for(var c in a)ba(a,c)&&b.push(c);return b},da=b(Object.prototype.toString);T="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var ea="From previous event:";l.resolve=l,l.nextTick=W,l.longStackSupport=!1,"object"==typeof a&&a&&a.env&&a.env.Q_DEBUG&&(l.longStackSupport=!0),l.defer=m,m.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):arguments.length>2?a.resolve(Y(arguments,1)):a.resolve(c)}},l.Promise=n,l.promise=n,n.race=o,n.all=K,n.reject=A,n.resolve=l,l.passByCopy=function(a){return a},p.prototype.passByCopy=function(){return this},l.join=function(a,b){return l(a).join(b)},p.prototype.join=function(a){return l([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},l.race=o,p.prototype.race=function(){return this.then(l.race)},l.makePromise=p,p.prototype.toString=function(){return"[object Promise]"},p.prototype.then=function(a,b,c){function d(b){try{return"function"==typeof a?a(b):b}catch(c){return A(c)}}function f(a){if("function"==typeof b){e(a,h);try{return b(a)}catch(c){return A(c)}}return A(a)}function g(a){return"function"==typeof c?c(a):a}var h=this,i=m(),j=!1;return l.nextTick(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(d(a)))},"when",[function(a){j||(j=!0,i.resolve(f(a)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!l.onerror)throw d;l.onerror(d)}c||i.notify(b)}]),i.promise},l.tap=function(a,b){return l(a).tap(b)},p.prototype.tap=function(a){return a=l(a),this.then(function(b){return a.fcall(b).thenResolve(b)})},l.when=q,p.prototype.thenResolve=function(a){return this.then(function(){return a})},l.thenResolve=function(a,b){return l(a).thenResolve(b)},p.prototype.thenReject=function(a){return this.then(function(){throw a})},l.thenReject=function(a,b){return l(a).thenReject(b)},l.nearer=r,l.isPromise=s,l.isPromiseAlike=t,l.isPending=u,p.prototype.isPending=function(){return"pending"===this.inspect().state},l.isFulfilled=v,p.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},l.isRejected=w,p.prototype.isRejected=function(){return"rejected"===this.inspect().state};var fa=[],ga=[],ha=[],ia=!0;l.resetUnhandledRejections=x,l.getUnhandledReasons=function(){return fa.slice()},l.stopUnhandledRejectionTracking=function(){x(),ia=!1},x(),l.reject=A,l.fulfill=B,l.master=D,l.spread=E,p.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},l.async=F,l.spawn=G,l["return"]=H,l.promised=I,l.dispatch=J,p.prototype.dispatch=function(a,b){var c=this,d=m();return l.nextTick(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},l.get=function(a,b){return l(a).dispatch("get",[b])},p.prototype.get=function(a){return this.dispatch("get",[a])},l.set=function(a,b,c){return l(a).dispatch("set",[b,c])},p.prototype.set=function(a,b){return this.dispatch("set",[a,b])},l.del=l["delete"]=function(a,b){return l(a).dispatch("delete",[b])},p.prototype.del=p.prototype["delete"]=function(a){return this.dispatch("delete",[a])},l.mapply=l.post=function(a,b,c){return l(a).dispatch("post",[b,c])},p.prototype.mapply=p.prototype.post=function(a,b){return this.dispatch("post",[a,b])},l.send=l.mcall=l.invoke=function(a,b){return l(a).dispatch("post",[b,Y(arguments,2)])},p.prototype.send=p.prototype.mcall=p.prototype.invoke=function(a){return this.dispatch("post",[a,Y(arguments,1)])},l.fapply=function(a,b){return l(a).dispatch("apply",[void 0,b])},p.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},l["try"]=l.fcall=function(a){return l(a).dispatch("apply",[void 0,Y(arguments,1)])},p.prototype.fcall=function(){return this.dispatch("apply",[void 0,Y(arguments)])},l.fbind=function(a){var b=l(a),c=Y(arguments,1);return function(){return b.dispatch("apply",[this,c.concat(Y(arguments))])}},p.prototype.fbind=function(){var a=this,b=Y(arguments);return function(){return a.dispatch("apply",[this,b.concat(Y(arguments))])}},l.keys=function(a){return l(a).dispatch("keys",[])},p.prototype.keys=function(){return this.dispatch("keys",[])},l.all=K,p.prototype.all=function(){return K(this)},l.any=L,p.prototype.any=function(){return L(this)},l.allResolved=k(M,"allResolved","allSettled"),p.prototype.allResolved=function(){return M(this)},l.allSettled=N,p.prototype.allSettled=function(){return this.then(function(a){return K(_(a,function(a){function b(){return a.inspect()}return a=l(a),a.then(b,b)}))})},l.fail=l["catch"]=function(a,b){return l(a).then(void 0,b)},p.prototype.fail=p.prototype["catch"]=function(a){return this.then(void 0,a)},l.progress=O,p.prototype.progress=function(a){return this.then(void 0,void 0,a)},l.fin=l["finally"]=function(a,b){return l(a)["finally"](b)},p.prototype.fin=p.prototype["finally"]=function(a){return a=l(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},l.done=function(a,b,c,d){return l(a).done(b,c,d)},p.prototype.done=function(b,c,d){var f=function(a){l.nextTick(function(){if(e(a,g),!l.onerror)throw a;l.onerror(a)})},g=b||c||d?this.then(b,c,d):this;"object"==typeof a&&a&&a.domain&&(f=a.domain.bind(f)),g.then(void 0,f)},l.timeout=function(a,b,c){return l(a).timeout(b,c)},p.prototype.timeout=function(a,b){var c=m(),d=setTimeout(function(){b&&"string"!=typeof b||(b=new Error(b||"Timed out after "+a+" ms"),b.code="ETIMEDOUT"),c.reject(b)},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},l.delay=function(a,b){return void 0===b&&(b=a,a=void 0),l(a).delay(b)},p.prototype.delay=function(a){return this.then(function(b){var c=m();return setTimeout(function(){c.resolve(b)},a),c.promise})},l.nfapply=function(a,b){return l(a).nfapply(b)},p.prototype.nfapply=function(a){var b=m(),c=Y(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},l.nfcall=function(a){var b=Y(arguments,1);return l(a).nfapply(b)},p.prototype.nfcall=function(){var a=Y(arguments),b=m();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},l.nfbind=l.denodeify=function(a){var b=Y(arguments,1);return function(){var c=b.concat(Y(arguments)),d=m();return c.push(d.makeNodeResolver()),l(a).fapply(c).fail(d.reject),d.promise}},p.prototype.nfbind=p.prototype.denodeify=function(){var a=Y(arguments);return a.unshift(this),l.denodeify.apply(void 0,a)},l.nbind=function(a,b){var c=Y(arguments,2);return function(){function d(){return a.apply(b,arguments)}var e=c.concat(Y(arguments)),f=m();return e.push(f.makeNodeResolver()),l(d).fapply(e).fail(f.reject),f.promise}},p.prototype.nbind=function(){var a=Y(arguments,0);return a.unshift(this),l.nbind.apply(void 0,a)},l.nmapply=l.npost=function(a,b,c){return l(a).npost(b,c)},p.prototype.nmapply=p.prototype.npost=function(a,b){var c=Y(b||[]),d=m();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},l.nsend=l.nmcall=l.ninvoke=function(a,b){var c=Y(arguments,2),d=m();return c.push(d.makeNodeResolver()),l(a).dispatch("post",[b,c]).fail(d.reject),d.promise},p.prototype.nsend=p.prototype.nmcall=p.prototype.ninvoke=function(a){var b=Y(arguments,1),c=m();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},l.nodeify=P,p.prototype.nodeify=function(a){return a?void this.then(function(b){l.nextTick(function(){a(null,b)})},function(b){l.nextTick(function(){a(b)})}):this},l.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var ja=j();return l})}).call(this,a("_process"))},{_process:29}],2:[function(a,b,c){b.exports={DELIVERY:"DELIVERY",SEAT:"SEAT",PICKUP:"PICKUP"}},{}],3:[function(a,b,c){b.exports={CASH:"CASH",CARD:"CARD"}},{}],4:[function(a,b,c){!function(a,d){"function"==typeof define&&define.amd?define(d):"object"==typeof c?b.exports=d:a.atomic=d(a)}(this,function(a){var b={},c=function(a){var b;try{b=JSON.parse(a.responseText)}catch(c){b=a.responseText}return[b,a]},d=function(b,d,e){var f={success:function(){},error:function(){}},g=a.XMLHttpRequest||ActiveXObject,h=new g("MSXML2.XMLHTTP.3.0");return h.open(b,d,!0),h.setRequestHeader("Content-type","application/json"),h.onreadystatechange=function(){4===h.readyState&&(h.status<300?f.success.apply(f,c(h)):f.error.apply(f,c(h)))},h.send(e),{success:function(a){return f.success=a,this},error:function(a){return f.error=a,this}}};return b.get=function(a){return d("GET",a)},b.put=function(a,b){return d("PUT",a,b)},b.patch=function(a,b){return d("PATCH",a,b)},b.post=function(a,b){return d("POST",a,b)},b["delete"]=function(a){return d("DELETE",a)},b})},{}],5:[function(a,b,c){(function(){var a,c,d,e,f,g={}.hasOwnProperty,h=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i=this;for(this.Stripe=function(){function a(){}return a.version=2,a.endpoint="https://api.stripe.com/v1",a.setPublishableKey=function(b){a.key=b},a.complete=function(b){return function(c,d,e){var f;return"success"!==c?(f=Math.round((new Date).getTime()/1e3),(new Image).src="https://q.stripe.com?event=stripejs-error&type="+c+"&key="+a.key+"&timestamp="+f,"function"==typeof b?b(500,{error:{code:c,type:c,message:"An unexpected error has occurred submitting your credit\ncard to our secure credit card processor. This may be\ndue to network connectivity issues, so you should try\nagain (you won't be charged twice). If this problem\npersists, please let us know!"}}):void 0):void 0}},a}.call(this),a=this.Stripe,this.Stripe.token=function(){function b(){}return b.validate=function(a,b){if(!a)throw b+" required";if("object"!=typeof a)throw b+" invalid"},b.formatData=function(b,c){return a.utils.isElement(b)&&(b=a.utils.paramsFromForm(b,c)),a.utils.underscoreKeys(b),b},b.create=function(b,c){return b.key||(b.key=a.key||a.publishableKey),a.utils.validateKey(b.key),a.ajaxJSONP({url:""+a.endpoint+"/tokens",data:b,method:"POST",success:function(a,b){return"function"==typeof c?c(b,a):void 0},complete:a.complete(c),timeout:4e4})},b.get=function(b,c){if(!b)throw"token required";return a.utils.validateKey(a.key),a.ajaxJSONP({url:""+a.endpoint+"/tokens/"+b,data:{key:a.key},success:function(a,b){return"function"==typeof c?c(b,a):void 0},complete:a.complete(c),timeout:4e4})},b}.call(this),this.Stripe.card=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return h(c,b),c.tokenName="card",c.whitelistedAttrs=["number","cvc","exp_month","exp_year","name","address_line1","address_line2","address_city","address_state","address_zip","address_country"],c.createToken=function(b,d,e){var f;return null==d&&(d={}),a.token.validate(b,"card"),"function"==typeof d?(e=d,d={}):"object"!=typeof d&&(f=parseInt(d,10),d={},f>0&&(d.amount=f)),d[c.tokenName]=a.token.formatData(b,c.whitelistedAttrs),a.token.create(d,e)},c.getToken=function(b,c){return a.token.get(b,c)},c.validateCardNumber=function(a){return a=(a+"").replace(/\s+|-/g,""),a.length>=10&&a.length<=16&&c.luhnCheck(a)},c.validateCVC=function(b){return b=a.utils.trim(b),/^\d+$/.test(b)&&b.length>=3&&b.length<=4},c.validateExpiry=function(b,c){var d,e;return b=a.utils.trim(b),c=a.utils.trim(c),/^\d+$/.test(b)&&/^\d+$/.test(c)&&parseInt(b,10)<=12?(e=new Date(c,b),d=new Date,e.setMonth(e.getMonth()-1),e.setMonth(e.getMonth()+1,1),e>d):!1},c.luhnCheck=function(a){var b,c,d,e,f,g;for(d=!0,e=0,c=(a+"").split("").reverse(),f=0,g=c.length;g>f;f++)b=c[f],b=parseInt(b,10),(d=!d)&&(b*=2),b>9&&(b-=9),e+=b;return e%10===0},c.cardType=function(a){return c.cardTypes[a.slice(0,2)]||"Unknown"},c.cardTypes=function(){var a,b,c,d;for(b={},a=c=40;49>=c;a=++c)b[a]="Visa";for(a=d=50;59>=d;a=++d)b[a]="MasterCard";return b[34]=b[37]="American Express",b[60]=b[62]=b[64]=b[65]="Discover",b[35]="JCB",b[30]=b[36]=b[38]=b[39]="Diners Club",b}(),c}.call(this,this.Stripe.token),this.Stripe.bankAccount=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return h(c,b),c.tokenName="bank_account",c.whitelistedAttrs=["country","routing_number","account_number"],c.createToken=function(b,d,e){return null==d&&(d={}),a.token.validate(b,"bank account"),"function"==typeof d&&(e=d,d={}),d[c.tokenName]=a.token.formatData(b,c.whitelistedAttrs),a.token.create(d,e)},c.getToken=function(b,c){return a.token.get(b,c)},c.validateRoutingNumber=function(b,d){switch(b=a.utils.trim(b),d){case"US":return/^\d+$/.test(b)&&9===b.length&&c.routingChecksum(b);case"CA":return/\d{5}\-\d{3}/.test(b)&&9===b.length;default:return!0}},c.validateAccountNumber=function(b,c){switch(b=a.utils.trim(b),c){case"US":return/^\d+$/.test(b)&&b.length>=1&&b.length<=17;default:return!0}},c.routingChecksum=function(a){var b,c,d,e,f,g;for(d=0,b=(a+"").split(""),g=[0,3,6],e=0,f=g.length;f>e;e++)c=g[e],d+=3*parseInt(b[c]),d+=7*parseInt(b[c+1]),d+=parseInt(b[c+2]);return 0!==d&&d%10===0},c}.call(this,this.Stripe.token),c=["createToken","getToken","cardType","validateExpiry","validateCVC","validateCardNumber"],e=0,f=c.length;f>e;e++)d=c[e],this.Stripe[d]=this.Stripe.card[d];"undefined"!=typeof b&&null!==b&&(b.exports=this.Stripe),"function"==typeof define&&define("stripe",[],function(){return i.Stripe})}).call(this),function(){var a,b,c,d=[].slice;a=encodeURIComponent,b=(new Date).getTime(),c=function(b,d,e){var f,g;null==d&&(d=[]);for(f in b)g=b[f],e&&(f=""+e+"["+f+"]"),"object"==typeof g?c(g,d,f):d.push(""+f+"="+a(g));return d.join("&").replace(/%20/g,"+")},this.Stripe.ajaxJSONP=function(a){var e,f,g,h,i,j;return null==a&&(a={}),g="sjsonp"+ ++b,i=document.createElement("script"),f=null,e=function(b){var c;return null==b&&(b="abort"),clearTimeout(f),null!=(c=i.parentNode)&&c.removeChild(i),g in window&&(window[g]=function(){}),"function"==typeof a.complete?a.complete(b,j,a):void 0},j={abort:e},i.onerror=function(){return j.abort(),"function"==typeof a.error?a.error(j,a):void 0},window[g]=function(){var b;b=1<=arguments.length?d.call(arguments,0):[],clearTimeout(f),i.parentNode.removeChild(i);try{delete window[g]}catch(c){window[g]=void 0}return"function"==typeof a.success&&a.success.apply(a,b),"function"==typeof a.complete?a.complete("success",j,a):void 0},a.data||(a.data={}),a.data.callback=g,a.method&&(a.data._method=a.method),i.src=a.url+"?"+c(a.data),h=document.getElementsByTagName("head")[0],h.appendChild(i),a.timeout>0&&(f=setTimeout(function(){return j.abort("timeout")},a.timeout)),j}}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};this.Stripe.utils=function(){function b(){}return b.trim=function(a){return(a+"").replace(/^\s+|\s+$/g,"")},b.underscore=function(a){return(a+"").replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()}).replace(/-/g,"_")},b.underscoreKeys=function(a){var b,c,d;d=[];for(b in a)c=a[b],delete a[b],d.push(a[this.underscore(b)]=c);return d},b.isElement=function(a){return"object"!=typeof a?!1:"undefined"!=typeof jQuery&&null!==jQuery&&a instanceof jQuery?!0:1===a.nodeType},b.paramsFromForm=function(b,c){var d,e,f,g,h,i,j,k,l,m;for(null==c&&(c=[]),"undefined"!=typeof jQuery&&null!==jQuery&&b instanceof jQuery&&(b=b[0]),f=b.getElementsByTagName("input"),h=b.getElementsByTagName("select"),i={},j=0,l=f.length;l>j;j++)e=f[j],d=this.underscore(e.getAttribute("data-stripe")),a.call(c,d)<0||(i[d]=e.value);for(k=0,m=h.length;m>k;k++)g=h[k],d=this.underscore(g.getAttribute("data-stripe")),a.call(c,d)<0||null!=g.selectedIndex&&(i[d]=g.options[g.selectedIndex].value);return i},b.validateKey=function(a){if(!a||"string"!=typeof a)throw new Error("You did not set a valid publishable key. Call Stripe.setPublishableKey() with your publishable key. For more info, see https://stripe.com/docs/stripe.js");if(/\s/g.test(a))throw new Error("Your key is invalid, as it contains whitespace. For more info, see https://stripe.com/docs/stripe.js");if(/^sk_/.test(a))throw new Error("You are using a secret key with Stripe.js, instead of the publishable one. For more info, see https://stripe.com/docs/stripe.js")},b}()}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};this.Stripe.validator={"boolean":function(a,b){return"true"!==b&&"false"!==b?"Enter a boolean string (true or false)":void 0},integer:function(a,b){return/^\d+$/.test(b)?void 0:"Enter an integer"},positive:function(a,b){return!this.integer(a,b)&&parseInt(b,10)>0?void 0:"Enter a positive value"},range:function(b,c){var d;return d=parseInt(c,10),a.call(b,d)<0?"Needs to be between "+b[0]+" and "+b[b.length-1]:void 0},required:function(a,b){return!a||null!=b&&""!==b?void 0:"Required"},year:function(a,b){return/^\d{4}$/.test(b)?void 0:"Enter a 4-digit year"},birthYear:function(a,b){var c;return c=this.year(a,b),c?c:parseInt(b,10)>2e3?"You must be over 18":parseInt(b,10)<1900?"Enter your birth year":void 0},month:function(a,b){return this.integer(a,b)?"Please enter a month":this.range([1,2,3,4,5,6,7,8,9,10,11,12],b)?"Needs to be between 1 and 12":void 0},choices:function(b,c){return a.call(b,c)<0?"Not an acceptable value for this field":void 0},email:function(a,b){return/^[^@<\s>]+@[^@<\s>]+$/.test(b)?void 0:"That doesn't look like an email address"},url:function(a,b){return/^https?:\/\/.+\..+/.test(b)?void 0:"Not a valid url"},usTaxID:function(a,b){return/^\d{2}-?\d{1}-?\d{2}-?\d{4}$/.test(b)?void 0:"Not a valid tax ID"},ein:function(a,b){return/^\d{2}-?\d{7}$/.test(b)?void 0:"Not a valid EIN"},ssnLast4:function(a,b){return/^\d{4}$/.test(b)?void 0:"Not a valid last 4 digits for an SSN"},ownerPersonalID:function(a,b){var c;return c=function(){switch(a){case"CA":return/^\d{3}-?\d{3}-?\d{3}$/.test(b);case"US":return!0}}(),c?void 0:"Not a valid ID"},bizTaxID:function(a,b){var c,d,e,f,g,h,i,j;if(h={CA:["Tax ID",[/^\d{9}$/]],US:["EIN",[/^\d{2}-?\d{7}$/]]},g=h[a],null!=g){for(c=g[0],f=g[1],d=!1,i=0,j=f.length;j>i;i++)if(e=f[i],e.test(b)){d=!0;break}if(!d)return"Not a valid "+c}},zip:function(a,b){var c;return c=function(){switch(a.toUpperCase()){case"CA":return/^[\d\w]{6}$/.test(null!=b?b.replace(/\s+/g,""):void 0);case"US":return/^\d{5}$/.test(b)||/^\d{9}$/.test(b)}}(),c?void 0:"Not a valid zip"},bankAccountNumber:function(a,b){return/^\d{1,17}$/.test(b)?void 0:"Invalid bank account number"},usRoutingNumber:function(a){var b,c,d,e,f,g,h;if(!/^\d{9}$/.test(a))return"Routing number must have 9 digits";for(f=0,b=g=0,h=a.length-1;h>=g;b=g+=3)c=3*parseInt(a.charAt(b),10),d=7*parseInt(a.charAt(b+1),10),e=parseInt(a.charAt(b+2),10),f+=c+d+e;return 0===f||f%10!==0?"Invalid routing number":void 0},caRoutingNumber:function(a){return/^\d{5}\-\d{3}$/.test(a)?void 0:"Invalid transit number"},routingNumber:function(a,b){switch(a.toUpperCase()){case"CA":return this.caRoutingNumber(b);case"US":return this.usRoutingNumber(b)}},phoneNumber:function(a,b){var c;return c=b.replace(/[^0-9]/g,""),10!==c.length?"Invalid phone number":void 0},bizDBA:function(a,b){return/^.{1,23}$/.test(b)?void 0:"Statement descriptors can only have up to 23 characters"},nameLength:function(a,b){return 1===b.length?"Names need to be longer than one character":void 0}}}.call(this)},{}],6:[function(a,b,c){function d(a){a&&h.extend(this,a)}function e(a){var b=this;return a&&(b=a),[b.address1,b.address2,b.address3,b.city,b.county].join(", ")}var f=a("../../node_modules/q/q"),g=(a("../lib/stripe.min"),a("../services/api")),h=a("../services/util"),i=a("./user"),j=a("./venue");d.prototype.getAll=function(a){if(!i.isLogged())return f.reject({message:"User not logged"});var b=i.getCurrent(),c=f.defer();return g.get("users/"+b.id+"/addresses").then(function(a){b.addresses=a.map(function(a){return new d(a)}),c.resolve(b.addresses)},function(a){c.reject(a)}),c.promise},d.prototype.save=function(a){if(!i.isLogged())return f.reject({message:"User not logged"});if(!j.getCurrent())return f.reject({message:"Venue not logged"});if(!(a instanceof Object))return f.reject({message:"Incorrect addresses parameter"});a.country=a.country||"UK";var b=f.defer(),c=i.getCurrent();return h.extend(a,{userId:c.id}),g.post("users/"+c.id+"/addresses",a).then(function(a){var e=new d(a);c.addresses.push(e),b.resolve(e)},function(a){b.reject(a)}),b.promise},d.prototype.update=function(a){if(!i.isLogged())return f.reject({message:"User not logged"});if(!j.getCurrent())return f.reject({message:"Venue not logged"});if(!(a instanceof Object&&a.id))return f.reject({message:"Incorrect address parameter"});var b=f.defer(),c=i.getCurrent();return h.extend(a,{userId:c.id}),g.put("users/"+c.id+"/addresses/"+a.id,a).then(function(a){var e=new d(a);c.updateAddress(e),b.resolve(e)},function(a){b.reject(a)}),b.promise},d.prototype["delete"]=function(a){if(!i.isLogged())return f.reject({message:"User not logged"});if(!(a instanceof Object&&a.id))return f.reject({message:"Incorrect address parameter"});var b=f.defer(),c=i.getCurrent();return g["delete"]("users/"+c.id+"/addresses/"+a.id).then(function(){i.getCurrent().removeAddress(a),b.resolve()},function(a){b.reject(a)}),b.promise},d.prototype.stringify=e,d.stringify=e,b.exports=d},{"../../node_modules/q/q":1,"../lib/stripe.min":5,"../services/api":26,"../services/util":28,"./user":23,"./venue":24}],7:[function(a,b,c){function d(){G={total:0}}function e(){F={i:[],n:null},d()}function f(a){console.log("adding item .... ",a,x),d();var b=g(a);b?b.increment(a.item.quantity||1):F.i.push(new x({item:a.item,modifiers:a.modifiers,mealDeals:a.mealDeals}))}function g(a){var b=F.i.filter(function(b){return b.i===a.item.id}),c="",d="";a.item.isMealDeal()?(c="mealDeals",d="md"):(d="m",c="modifiers");var e=null;if(b.length)if(a[c]&&a[c].length)for(var f=a[c].map(function(a){return a instanceof y?a.i:a.id}),g=0,h=b.length;h>g;g++){var i=b[g][d].filter(function(a){return-1!==f.indexOf(a.i)});if(i.length&&i.length===f.length){e=b[g];break}}else for(var g=0,h=b.length;h>g;g++)if(!b[g][d].length){e=b[g];break}return e||!1}function h(a){var b=g(a);return b?(d(),F.i.splice(F.i.indexOf(b),1),v.resolve()):v.reject({message:"Item not found"})}function i(){for(;F.i.length>0;)F.i.pop();d()}function j(){return G&&G.total?G.total:k()}function k(){for(var a=0,b=0,c=F.i.length;c>b;b++)a+=+F.i[b].getPrice();return a}function l(a){for(var b=0,c=F.i.length-1;c>=0;c--)b=Math.max(b,F.i[c].leadTime||a);return b}function m(a){for(var b=Date.now(),c=Date.now(),d=F.i.length-1;d>=0;d--){var e=F.i[d],f=e.leadDays,g=e.leadDaysTime||0;if(f>0){var h=new Date,i=h.getDay()+1,j=B.getCloseTime(a,i);if(j){var k=j.split(":");h.setHours(k[0],k[1],0,0),h.setMinutes(h.getMinutes()-g),c>h.getTime()&&(j=!1)}if(!j)for(d=0;7>d&&(h.setDate(h.getDate()+1),!(j=B.getCloseTime(a,h.getDay()+1)));d++);h.setDate(h.getDate()+f),h.setHours(0,0,0,0),b=Math.max(b,h.getTime())}}return b}function n(a){var b=z.getCurrent();if(!b)return v.reject({message:"Venue not found"});a=a||{},b.isDelivery()&&a.orderType||(a.orderType=E.PICKUP);var c="";a.expand&&(c="?expand="+a.expand);var d=v.defer();return w.post("orders/basket"+c,{v:b.id,ot:a.orderType,i:F.i,e:a.eventId||void 0,pt:a.pickupTime||void 0}).then(function(a){G=a,d.resolve(a)},function(a){d.reject(a)}),d.promise}function o(){return G?G.fees:[]}function p(){return G?G.discounts:[]}function q(){return G?G.availableSlots:[]}function r(){var a=z.getCurrent();if(!a)return{};var b=a.settings||{},c=j(),d=c-(G.fee||0),e=b.deliveryOrderMin||0,f=b.orderMin||0,g={
total:c||0,deliveryCharge:b.deliveryCharge||0,deliveryOrderMin:e,deliveryDifference:Math.max(0,e-d),orderMin:f,orderDifference:Math.max(0,f-d)};return g}function s(){return G}function t(a){if(!(a instanceof Object))return v.reject({message:"Invalid parameter. Expected Object"});var b=null,c=null,d=null,e=null,f=function(a){return[a.getFullYear(),a.getMonth()+1,a.getDate()].join("-")+"T"+[a.getHours(),a.getMinutes(),"00"].join(":")+".000"};a.deliveryState?(b=C.stringify(a.address),c=a.address.postcode,z.getCurrent().isDelivery()&&!a.orderType&&(a.orderType=E.DELIVERY)):(b=a.deliveryAddress,a.orderType||(a.outletLocation&&a.outletLocation.toSeatFlag?a.orderType=E.SEAT:a.orderType=E.PICKUP));var g=null;if(a.event){var h=a.event.schedules?new Date(a.event.date):null;if(g=a.pickupSlot,null!==h){if(a.pickupTime){var i=a.pickupTime.split(":");h.setHours(i[0]),h.setMinutes(i[1])}d=f(h)}e=a.event.id}else d=a.pickupSlot?a.pickupSlot+"T"+a.pickupTime+":00.000":a.pickupTime;a.paymentType===D.CASH&&(a.paymentMethod=null);var k={o:a.outletId,ot:a.orderType,da:b,dp:c,i:F.i,t:j(),pm:a.paymentMethod,pt:d,e:e,ps:g,n:a.notes,ptype:a.paymentType};return A.save(k)}function u(){e()}var v=a("../../node_modules/q/q"),w=a("../services/api"),x=(a("../services/util"),a("./basketItem")),y=a("./basketModifierItem"),z=a("./venue"),A=a("./order"),B=(a("./user"),a("./hour")),C=a("./addresses"),D=a("../constants/paymentMethods"),E=a("../constants/orderType"),F={},G=null;e(),b.exports={addItem:f,removeItem:h,removeAll:i,total:j,totalCore:k,getSlots:q,getCostDetails:r,getDiscounts:p,getFees:o,getOrderDetail:s,maxLeadTime:l,maxPickupTime:m,checkDiscount:n,processOrder:t,clear:u,getItems:function(){return F.i}}},{"../../node_modules/q/q":1,"../constants/orderType":2,"../constants/paymentMethods":3,"../services/api":26,"../services/util":28,"./addresses":6,"./basketItem":8,"./basketModifierItem":9,"./hour":11,"./order":17,"./user":23,"./venue":24}],8:[function(a,b,c){function d(a){a.item&&e.call(this,a)}function e(a){var b=a.item;this.i=b.id,this.plu=b.plu,this.n=b.name,this.p=b.price,this.q=b.quantity||1,this.nt=b.notes,this.m=[],this.md=[],a.modifiers&&a.modifiers.length&&f.call(this,a.modifiers),a.mealDeals&&a.mealDeals.length&&g.call(this,a.mealDeals)}function f(a){for(var b=0,c=a.length;c>b;b++)this.m.push(new j(a[b]))}function g(a){for(var b=0,c=a.length;c>b;b++)this.md.push(new d({item:a[b]}))}function h(){for(var a=0,b=this.m.length-1;b>=0;b--)a+=+this.m[b].p||0;return a}function i(){for(var a=0,b=this.md.length-1;b>=0;b--)a+=+this.md[b].p||0;return a}var j=a("./basketModifierItem");d.prototype.increment=function(a){this.q+=a},d.prototype.decrement=function(){this.q&&--this.q},d.prototype.getPrice=function(){var a=0;return this.m&&this.m.length&&(a+=h.call(this)),this.md&&this.md.length&&(a+=i.call(this)),((+a+ +this.p)*+this.q).toFixed(2)},b.exports=d},{"./basketModifierItem":9}],9:[function(a,b,c){function d(a){a&&e.call(this,a)}function e(a){this.i=a.id,this.n=a.name,this.p=a.price}b.exports=d},{}],10:[function(a,b,c){function d(a){a&&g.extend(this,a)}var e=a("../../node_modules/q/q"),f=a("../services/api"),g=a("../services/util");a("./venue");d.prototype.getAll=function(a,b){var c=a,h=b?g.serialize(b):"";if(!c)return e.reject({message:"Venue not found"});var i=e.defer();return f.get("venues/"+c+"/events?"+h).then(function(a){var b=a.map(function(a){return new d(a)});i.resolve(b)},function(a){i.reject(a)}),i.promise},d.prototype.create=function(a,b){if(!b||!b.name)return e.reject({message:"Malformed data to save."});var c=e.defer();return f.post("venues/"+a+"/events",b).then(function(a){c.resolve(new d(a))},function(a){c.reject(a)}),c.promise},d.prototype.save=function(a){if(!a||!a.name)return e.reject({message:"Malformed data to update."});var b=e.defer(),c=this.id;return f.put("events/"+c,a).then(function(a){b.resolve(new d(a))},function(a){b.reject(a)}),b.promise},d.prototype["delete"]=function(){if(!this.id)return e.reject({message:"Malformed event, did you run the constructor?"});var a=e.defer();return f["delete"]("events/"+this.id).then(function(b){a.resolve(b)},function(b){a.reject(b)}),a.promise},d.prototype.deleteSlots=function(){if(!this.id)return e.reject({message:"Malformed event, did you run the constructor?"});var a=e.defer();return f["delete"]("events/"+this.id+"/slots").then(function(b){a.resolve(b)},function(b){a.reject(b)}),a.promise},b.exports=d},{"../../node_modules/q/q":1,"../services/api":26,"../services/util":28,"./venue":24}],11:[function(a,b,c){function d(a){a&&l.extend(this,a)}function e(a,b){return b=b||[h(a)],{name:f(a),value:g(a),slots:b}}function f(a){a=new Date(new Date(a).setHours(0,0,0,0));var b=new Date((new Date).setHours(0,0,0,0)),c=Math.abs(b.getTime()-a.getTime()),d=Math.ceil(c/864e5);return 0==d?"Today":1==d?"Tomorrow":a.toDateString()}function g(a){var a=[a.getFullYear(),l.pad(a.getMonth()+1),l.pad(a.getDate())].join("-");return a}function h(a){var a=[l.pad(a.getHours()),l.pad(a.getMinutes())].join(":");return a}function i(a,b){var c=m.getCurrent();return c.hours=b.map(function(a){return new d(a)}),b&&b instanceof Object&&b.groupBy?j.resolve(this.groupByDay(b)):j.resolve(c.hours)}var j=a("../../node_modules/q/q"),k=a("../services/api"),l=a("../services/util"),m=a("./venue"),n=a("./basket"),o=30,p=15;d.prototype.getSlotTimes=function(a){if(!~["delivery","pickup"].indexOf(a))throw"Please ensure the type is either 'pickup' or 'delivery'.";var b=m.getCurrent();if(!b)throw"Venue not logged";var c=b.hours;if(c&&c.length){var d=b.settings,e=d&&d.collectInterval||p;if("pickup"==a)var f=d&&d.leadTime||o;else var f=d&&d.deliveryLeadTime||o;f=n.maxLeadTime(f);var g=n.maxPickupTime(c);return g=Math.max(g,Date.now()+60*f*1e3),this.getTimes(4,c,e,f,new Date(g),a)}},d.prototype.getTimes=function(a,b,c,d,f,g){if(!~["delivery","pickup"].indexOf(g))throw new Error("Please ensure the type is either 'pickup' or 'delivery'.");for(var h=[],i=f||new Date,j=i.getDay()+1,k=0;7>k;k++){for(var m=b.filter(function(a){return a.day===j}),n=[],o=0,p=m.length;p>o;o++){var q=m[o];if(q[g]){var r=new l.TimeRange(q.open,q.close);[].push.apply(n,r.getValues(c,d,0==k?i:!1))}}if(n.length>0&&h.push(e(i,n)),h.length==a)break;i.setDate(i.getDate()+1),j=j>6?1:j+1}return h},d.prototype.getAll=function(a){var b=m.getCurrent();if(!b)return j.reject({message:"Venue not found"});var c=j.defer();return k.get("venues/"+b.id+"/hours").then(function(b){i.apply(this,[a,b]).then(function(a){c.resolve(a)})},function(a){c.reject(a)}),c.promise},d.prototype.groupByDay=function(a){for(var b=[],c=0,d=0;7>d;d++){c=6>d?d+2:1;var e=a.filter(function(a){return a.day===c});b.push({day:d,hours:[]});for(var f=0,g=e.length;g>f;f++)b[d].hours.push({open:e[f].open.slice(0,5),close:e[f].close.slice(0,5)})}return b},d.getCloseTime=function(a,b){for(var a=a.filter(function(a){return a.day==b}),c=null,d=a.length-1;d>=0;d--){var e=a[d].close;null===c?c=e:e>c&&(c=e)}return c},b.exports=d},{"../../node_modules/q/q":1,"../services/api":26,"../services/util":28,"./basket":7,"./venue":24}],12:[function(a,b,c){function d(a){a&&(g.extend(this,a),e.call(this),this.mealDeal&&f.call(this))}function e(){this.modifiers=this.modifiers.map(function(a){return new h(a)})}function f(){this.mealDealSections=this.mealDealSections.map(function(a){return new i(a)})}var g=a("../services/util"),h=a("./modifier"),i=a("./mealDealSection");d.prototype.isMealDeal=function(){return 1===this.mealDeal},d.prototype.getFromPrice=function(){var a=this.price||0;for(var b in this.modifiers){var c=this.modifiers[b],d=1/0;if(c.minChoices>0){for(var e in c.items){var f=c.items[e].price||0;d>f&&(d=f)}d!==1/0&&(a+=d)}}return a},b.exports=d},{"../services/util":28,"./mealDealSection":13,"./modifier":15}],13:[function(a,b,c){function d(a){a&&e.extend(this,a)}var e=a("../services/util");b.exports=d},{"../services/util":28}],14:[function(a,b,c){function d(a){a&&(g.extend(this,a),e.call(this))}function e(){this.sections=this.sections.map(function(a){return new i(a)})}var f=a("../../node_modules/q/q"),g=a("../services/util"),h=a("../services/api"),i=a("./section");d.prototype.get=function(a){var b=f.defer(),c="menus?expand=true";return a.outletId?c+="&outletId="+a.outletId:a.venueId&&(c+="&venueId="+a.venueId),h.get(c).then(function(a){var c=a.map(function(a){return new d(a)});b.resolve(c)},function(a){b.reject(a)}),b.promise},b.exports=d},{"../../node_modules/q/q":1,"../services/api":26,"../services/util":28,"./section":22}],15:[function(a,b,c){function d(a){a&&(f.extend(this,a),e.call(this))}function e(){this.items=this.items.map(function(a){return new g(a)})}var f=a("../services/util"),g=a("./modifierItem");b.exports=d},{"../services/util":28,"./modifierItem":16}],16:[function(a,b,c){function d(a){a&&e.extend(this,a)}var e=a("../services/util");b.exports=d},{"../services/util":28}],17:[function(a,b,c){function d(a){a&&i.extend(this,a)}function e(a,b){var c=g.defer();return a.status=b,a.update().then(function(){c.resolve()},function(){c.reject()}),c.promise}function f(a){var b=j.getCurrent(),c=k.getCurrent();if(!j.isLogged())return g.reject({message:"User not logged"});if(!c)return g.reject({message:"Venue not logged"});var d=g.defer();return i.extend(a,{v:c.id,u:b.id,ph:b.phone}),h.post("orders",a).then(function(a){d.resolve(a)},function(a){d.reject(a)}),d.promise}var g=a("../../node_modules/q/q"),h=a("../services/api"),i=a("../services/util"),j=a("./user"),k=a("./venue");d.prototype.getOrdersByUser=function(){var a=j.getCurrent(),b=k.getCurrent();if(!a)return g.reject({message:"User not logged"});if(!b)return g.reject({message:"Venue not logged"});var c=g.defer();return h.get("orders?userId="+a.id+"&venueId="+b.id).then(function(a){a=a.map(function(a){return new d(a)}),c.resolve(a)},function(a){c.reject(a)}),c.promise},d.prototype.get=function(a){if(!a)return g.reject({message:"Id is required"});var b=g.defer();return h.get("orders/"+a).then(function(a){b.resolve(new d(a))},function(a){b.reject(a)}),b.promise},d.prototype.fetch=function(a){var b=g.defer(),c=i.serialize(a);return h.get("orders"+(c?"?"+c:null)).then(function(a){a=a.map(function(a){return new d(a)}),b.resolve(a)},function(a){b.reject(a)}),b.promise},d.prototype.read=function(a){var b=null;if(this.id)b=this.id;else{if(!a)return g.reject({message:"Id is required"});b=a}var c=g.defer(),d=this;return h.post("orders/"+b+"/read").then(function(){d.viewed=new Date,c.resolve()},function(a){c.reject(a)}),c.promise},d.prototype.charge=function(a){var b=null;if(this.id)b=this.id;else{if(!a)return g.reject({message:"Id is required"});b=a}var c=g.defer();return h.post("orders/"+b+"/charge").then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise},d.prototype.notify=function(a){if(!this.id)return g.reject({message:"Invalid order"});var b=g.defer();return h.post("orders/"+this.id+"/notify",{content:a}).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise},d.prototype.reject=function(a){if(!this.id)return g.reject({message:"Invalid order"});var b=g.defer();return h.post("orders/"+this.id+"/reject",{content:a}).then(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise},d.prototype.noShow=function(){return e(this,"NOSHOW")},d.prototype.complete=function(a){var b=null;return a?(b=new d,b.id=a):b=this,e(b,"COMPLETED")},d.prototype.preparing=function(){return e(this,"PREPARING")},d.prototype.ready=function(){return e(this,"READY")},d.prototype.delivering=function(){return e(this,"DELIVERING")},d.prototype.save=f,d.save=f,d.prototype.update=function(){j.getCurrent();if(!j.isLogged())return g.reject({message:"User not logged"});var a=g.defer();return h.put("orders/"+this.id,this).then(function(b){a.resolve(b)},function(b){a.reject(b)}),a.promise},b.exports=d},{"../../node_modules/q/q":1,"../services/api":26,"../services/util":28,"./user":23,"./venue":24}],18:[function(a,b,c){function d(a,b){a&&(i.extend(this,a),b&&b.length&&(k[a.id]=b.map(function(a){return new d(a,e(a.id))})))}function e(a){var b=l.filter(function(b){return b.id===a});if(b=b&&b.length&&b[0]||null,b&&b.seatStart&&b.seatEnd){for(var c=[],e=b.seatStart;e<=b.seatEnd;e++){var f=i.clone(b);f.id=b.id+"-"+e,f.name=e,c.push(new d(f))}return c}return l.filter(function(b){return b.parent===a})}function f(a,b){var c=j.getCurrent();l=a,k={};var f=null;f=b?e(b):a.filter(function(a){return!a.parent}),c.outlets=[];for(var g=0,h=f.length;h>g;g++)c.outlets.push(new d(f[g],e(f[g].id)))}var g=a("../../node_modules/q/q"),h=a("../services/api"),i=a("../services/util"),j=a("./venue"),k={},l=null;d.prototype.getAll=function(a){var b=j.getCurrent();if(!b)return g.reject({message:"Venue not found"});var c=g.defer(),d="venues/"+b.id+"/outletlocations",e=null;a instanceof Object&&a.outletLocationId&&(e=a.outletLocationId,d+="?root="+a.outletLocationId);var i=this;return h.get(d).then(function(a){f.call(i,a,e),c.resolve(b.outlets)},function(a){c.reject(a)}),c.promise},d.prototype.get=function(a){var b=g.defer(),c="outlets/"+a;return h.get(c).then(function(a){b.resolve(new d(a))},function(a){b.reject(a)}),b.promise},d.prototype.getChildrens=function(){return k[this.id]},b.exports=d},{"../../node_modules/q/q":1,"../services/api":26,"../services/util":28,"./venue":24}],19:[function(a,b,c){function d(a){a&&h.extend(this,a)}var e=a("../../node_modules/q/q"),f=a("../lib/stripe.min"),g=a("../services/api"),h=a("../services/util"),i=a("../services/settings"),j=a("./user"),k=a("./venue");d.prototype.getAll=function(a){if(!j.isLogged())return e.reject({message:"User not logged"});var b=j.getCurrent(),c=e.defer();return g.get("users/"+b.id+"/paymentmethods").then(function(a){b.paymentMethods=a.map(function(a){return new d(a)}),c.resolve(b.paymentMethods)},function(a){c.reject(a)}),c.promise},d.prototype.validate=function(a){var b=e.defer();return f.setPublishableKey(i.getSettings().stripeKey),f.createToken(a,function(a,c){c.error?b.reject({message:c.error.message}):b.resolve({token:c.id,name:c.card.name,type:c.card.type||c.card.brand,expMonth:c.card.exp_month,expYear:c.card.exp_year,number:c.card.last4})}),b.promise},d.prototype.save=function(a){if(!j.isLogged())return e.reject({message:"User not logged"});if(!k.getCurrent())return e.reject({message:"Venue not logged"});if(!(a instanceof Object))return e.reject({message:"Incorrect Payment Method parameter"});var b=e.defer(),c=j.getCurrent();return this.validate(a).then(function(a){angular.extend(a,{userId:c.id,venueId:k.getCurrent().id}),g.post("users/"+c.id+"/paymentmethods",a).then(function(a){var e=new d(a);c.paymentMethods.push(e),b.resolve(e)},function(a){b.reject(a)})},function(a){b.reject(a)}),b.promise},d.prototype["delete"]=function(a){if(!j.isLogged())return e.reject({message:"User not logged"});if(!(a instanceof Object&&a.id))return e.reject({message:"Incorrect Payment Method parameter"});var b=e.defer(),c=j.getCurrent();return g["delete"]("users/"+c.id+"/paymentmethods/"+a.id).then(function(){j.getCurrent().removePaymentMethod(a),b.resolve()},function(a){b.reject(a)}),b.promise},b.exports=d},{"../../node_modules/q/q":1,"../lib/stripe.min":5,"../services/api":26,"../services/settings":27,"../services/util":28,"./user":23,"./venue":24}],20:[function(a,b,c){function d(a){a&&g.extend(this,a)}var e=a("../../node_modules/q/q"),f=a("../services/api"),g=a("../services/util"),h=a("./venue");d.prototype.getPaymentProvidersByVenue=function(){var a=h.getCurrent();if(!a)return e.reject({message:"Venue not found"});var b=e.defer();return f.get("venues/"+a.id+"/paymentproviders").then(function(c){a.paymentProviders=c.map(function(a){return new d(a)}),b.resolve(a.paymentProviders)},function(a){b.reject(a)}),b.promise},b.exports=d},{"../../node_modules/q/q":1,"../services/api":26,"../services/util":28,"./venue":24}],21:[function(a,b,c){function d(a){a&&g.extend(this,a)}var e=a("../../node_modules/q/q"),f=a("../services/api"),g=a("../services/util");d.prototype.getAll=function(a){if(!a||!a.id)return e.reject({message:"Invalid event param"});var b=e.defer();return f.get("events/"+a.id+"/slots/slotConfig").then(function(a){var a=a.map(function(a){return new d(a)});b.resolve(a)},function(a){b.reject(a)}),b.promise},d.prototype.create=function(a){if(!a||!a.name||!a.eventId)return e.reject({message:"Malformed pickup slot, did you run the constructor?"});var b=e.defer();return f.post("events/"+a.eventId+"/slots",a).then(function(a){b.resolve(new d(a))},function(a){b.reject(a)}),b.promise},d.prototype.save=function(){if(void 0==this.id||void 0==this.eventId)return e.reject({message:"Malformed pickup slot, did you run the constructor?"});var a=e.defer();return f.put("events/"+this.eventId+"/slots/"+this.id,this).then(function(b){var b=b.map(function(a){return new d(a)});a.resolve(b)},function(b){a.reject(b)}),a.promise},d.prototype["delete"]=function(){this.id?"post":"put";if(!this.name||!this.eventId)return e.reject({message:"Malformed pickup slot, did you run the constructor?"});var a=e.defer();return this.id?f["delete"]("events/"+this.eventId+"/slots/"+this.id).then(function(b){var b=b.map(function(a){return new d(a)});a.resolve(b)},function(b){a.reject(b)}):a.resolve({message:"No slots to delete"}),a.promise},b.exports=d},{"../../node_modules/q/q":1,"../services/api":26,"../services/util":28}],22:[function(a,b,c){function d(a){a&&(f.extend(this,a),e.call(this))}function e(){this.items=this.items.map(function(a){return new g(a)})}var f=a("../services/util"),g=a("./item");b.exports=d},{"../services/util":28,"./item":12}],23:[function(a,b,c){function d(a){a&&(k.extend(this,a),e.call(this),f.call(this))}function e(){if(this.addresses){var b=a("./addresses");this.addresses=this.addresses.map(function(a){return new b(a)})}}function f(){if(this.paymentMethods){var b=a("./paymentMethod");this.paymentMethods=this.paymentMethods.map(function(a){return new b(a)})}}function g(){return l}function h(){return null!==l}var i=a("../../node_modules/q/q"),j=a("../services/api"),k=a("../services/util"),l=null;d.prototype.auth=function(a){if(!a)return i.reject({message:"Username and password is required"});if(!a.username)return i.reject({message:"Username is required"});if(!a.password)return i.reject({message:"Password is required"});var b=i.defer();return j.post("users/auth",{username:a.username,password:a.password}).then(function(a){l=new d(a),b.resolve(l)},function(a){b.reject(a)}),b.promise},d.prototype.forgotPassword=function(a){if(!a.email)return i.reject({message:"Email is required"});var b=i.defer();return j.post("users/auth/forgot",a).then(function(){b.resolve()},function(a){b.reject(a)}),b.promise},d.prototype.isAdmin=function(){var a=i.defer();return j.get("users/auth/roles/admin").then(function(){a.resolve()},function(b){a.reject(b)}),a.promise},d.prototype.save=function(a){if(d.isLogged())return i.reject({message:"User already logged"});if(!a.firstName)return i.reject({message:"First name is required"});if(!a.lastName)return i.reject({message:"Last name is required"});if(!a.email)return i.reject({message:"Email is required"});if(!a.password)return i.reject({message:"Password is required"});var b=i.defer();return j.post("users",a).then(function(a){l=new d(a),b.resolve(l)},function(a){b.reject(a)}),b.promise},d.prototype.update=function(a){if(!d.isLogged())return i.reject({message:"User not logged"});if(!a.firstName)return i.reject({message:"First name is required"});if(!a.lastName)return i.reject({message:"Last name is required"});if(!a.email)return i.reject({message:"Email is required"});var b=d.getCurrent(),c=i.defer();return j.patch("users/"+b.id,{firstName:a.firstName,lastName:a.lastName,email:a.email,phone:a.phone}).then(function(a){a.token=b.token,l=new d(a),c.resolve(l)},function(a){c.reject(a)}),c.promise},d.getCurrent=g,d.prototype.getCurrent=g,d.isLogged=h,d.prototype.isLogged=h,d.prototype.setUser=function(a){l=a},d.prototype.removePaymentMethod=function(a){var b=this.paymentMethods.map(function(a){return a.id}).indexOf(a.id);this.paymentMethods.splice(b,1)},d.prototype.updateAddress=function(a){var b=this.addresses.map(function(a){return a.id}).indexOf(a.id);this.addresses[b]=a},d.prototype.removeAddress=function(a){var b=this.addresses.map(function(a){return a.id}).indexOf(a.id);this.addresses.splice(b,1)},b.exports=d},{"../../node_modules/q/q":1,"../services/api":26,"../services/util":28,"./addresses":6,"./paymentMethod":19}],24:[function(a,b,c){function d(a){a&&g.extend(this,a)}var e=a("../../node_modules/q/q"),f=a("../services/api"),g=a("../services/util"),h=null;d.prototype.get=function(a){if(!a)return e.reject({message:"Venue identifier is required"});var b=e.defer();return this.fetch(a).then(function(a){h=a[0],b.resolve(a[0])},function(a){b.reject(a)}),b.promise},d.prototype.fetch=function(a){var b=e.defer(),c="venues",h="settings,hours";return a.venueId||a.permalink&&(delete a.venueId,c+="/permalink"),a.expand&&(h+=","+a.expand,delete a.expand),c+="?expand="+h+"&"+g.serialize(a),f.get(c).then(function(a){void 0===a.length&&(a=[a]);var c=a.map(function(a){return new d(a)});b.resolve(c)},function(a){b.reject(a)}),b.promise},d.prototype.getMessages=function(a){var b=null;if(this.id)b=this.id;else{if(!a)return e.reject({message:"Id is required"});b=a}var c=e.defer();return f.get("venues/"+b+"/messages").then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise},d.prototype.getHours=function(){return h=this,Preoday.Hour.getAll()},d.prototype.getPaymentProviders=function(){return h=this,Preoday.PaymentProvider.getPaymentProvidersByVenue()},d.getCurrent=function(){return h},d.prototype.isEvent=function(){return this.eventFlag},d.prototype.isDelivery=function(){return this.deliverFlag},d.prototype.isPickup=function(){return this.pickupFlag},d.prototype.isCashPaymentEnable=function(){return this.paymentProviders&&this.paymentProviders.filter(function(a){return"CASH"===a.type}).length},d.prototype.isCardPaymentEnable=function(){return this.paymentProviders&&this.paymentProviders.filter(function(a){return"Stripe"===a.type}).length},b.exports=d},{"../../node_modules/q/q":1,"../services/api":26,"../services/util":28}],25:[function(a,b,c){window.Preoday={Menu:new(a("./modules/menu")),Venue:new(a("./modules/venue")),Event:new(a("./modules/event")),PickupSlot:new(a("./modules/pickupSlot")),Outlet:new(a("./modules/outlet")),Hour:new(a("./modules/hour")),User:new(a("./modules/user")),PaymentMethod:new(a("./modules/paymentMethod")),PaymentProvider:new(a("./modules/paymentProvider")),Addresses:new(a("./modules/addresses")),Order:new(a("./modules/order")),Api:a("./services/api"),Basket:a("./modules/basket")};var d=a("./services/settings");d.loadConfig()},{"./modules/addresses":6,"./modules/basket":7,"./modules/event":10,"./modules/hour":11,"./modules/menu":14,"./modules/order":17,"./modules/outlet":18,"./modules/paymentMethod":19,"./modules/paymentProvider":20,"./modules/pickupSlot":21,"./modules/user":23,"./modules/venue":24,"./services/api":26,"./services/settings":27}],26:[function(a,b,c){function d(a){var b=j.defer();return k.get(l+a).success(function(a){b.resolve(a)}).error(function(a){b.reject(a)}),b.promise}function e(a,b){var c=j.defer();return k.post(l+a,b).success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise}function f(a,b){var c=j.defer();return k.put(l+a,b).success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise}function g(a,b){var c=j.defer();return k.patch(l+a,b).success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise}function h(a){var b=j.defer();return k["delete"](l+a).success(function(a){b.resolve(a)}).error(function(a){b.reject(a)}),b.promise}function i(a){return a instanceof Object&&(m=a),m}var j=a("../../node_modules/q/q"),k=new(a("../lib/atomic"))(window),l=(a("./util"),"/api/"),m={};b.exports={get:d,post:e,put:f,patch:g,headers:i,"delete":h,setUrlBase:function(a){l=a}},function(b){var c=function(a){for(var b in a)if(a.hasOwnProperty(b))if("$"===b.charAt(0))a[b]=void 0;else if(null!=a[b])if(a[b]instanceof Object)c(a[b]);else if(a[b].constructor==Array)for(var d=0;d<a[b].length;d++)c(a[b][d])};XMLHttpRequest.prototype.send=function(d){var e=(a("../modules/user"),a("../modules/venue"));for(var f in m)m.hasOwnProperty(f)&&this.setRequestHeader(f,m[f]);d instanceof Object&&c(d);var g=e.getCurrent();g&&this.setRequestHeader("preo-venueid",g.id),b.call(this,JSON.stringify(d))}}(XMLHttpRequest.prototype.send)},{"../../node_modules/q/q":1,"../lib/atomic":4,"../modules/user":23,"../modules/venue":24,"./util":28}],27:[function(a,b,c){function d(){var a=e.defer();return f.get("config/app").then(function(b){g=b,a.resolve()},function(b){a.reject(b)}),a.promise}var e=a("../../node_modules/q/q"),f=a("./api"),g=(a("./util"),null);b.exports={loadConfig:d,getSettings:function(){return g}}},{"../../node_modules/q/q":1,"./api":26,"./util":28}],28:[function(a,b,c){function d(a){return 10>a?"0"+a:a}a("../../node_modules/q/q");b.exports={extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},pad:d,TimeRange:function(a,b){this.start=a,this.end=b.replace(/^00:00/,"23:59");var c=this.start.split(":"),e=this.end.split(":");this.getValues=function(a,b,f){console.log("start here",f);var g=[],h=new Date;h.setHours(parseInt(c[0],10)),h.setMinutes(parseInt(c[1],10)+b);var i=new Date;i.setHours(parseInt(e[0],10)),i.setMinutes(parseInt(e[1],10)),i.setDate(h.getDate());var j=i.getTime();if(h.getTime()<j)for(;h.getTime()<=j;)(!f||h.getTime()>=f.getTime())&&g.push(d(h.getHours())+":"+d(h.getMinutes())),h.setMinutes(h.getMinutes()+a);return g}},serialize:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},clone:function(a){return JSON.parse(JSON.stringify(a))}}},{"../../node_modules/q/q":1}],29:[function(a,b,c){function d(){k=!1,h.length?j=h.concat(j):l=-1,j.length&&e()}function e(){if(!k){var a=setTimeout(d);k=!0;for(var b=j.length;b;){for(h=j,j=[];++l<b;)h[l].run();l=-1,b=j.length}h=null,k=!1,clearTimeout(a)}}function f(a,b){this.fun=a,this.array=b}function g(){}var h,i=b.exports={},j=[],k=!1,l=-1;i.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];j.push(new f(a,b)),1!==j.length||k||setTimeout(e,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(a){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(a){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}]},{},[25]),"bind"in Function.prototype||(Function.prototype.bind=function(a){var b=this;if(arguments.length<=1)return function(){return b.apply(a,arguments)};var c=Array.prototype.slice.call(arguments,1);return function(){return b.apply(a,0===arguments.length?c:c.concat(Array.prototype.slice.call(arguments)))}}),"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),"indexOf"in Array.prototype||(Array.prototype.indexOf=function(a,b){void 0===b&&(b=0),0>b&&(b+=this.length),0>b&&(b=0);for(var c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1}),"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(a,b){for(void 0===b&&(b=this.length-1),0>b&&(b+=this.length),b>this.length-1&&(b=this.length-1),b++;b-->0;)if(b in this&&this[b]===a)return b;return-1}),"forEach"in Array.prototype||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d>c;c++)c in this&&a.call(b,this[c],c,this)}),"map"in Array.prototype||(Array.prototype.map=function(a,b){for(var c=new Array(this.length),d=0,e=this.length;e>d;d++)d in this&&(c[d]=a.call(b,this[d],d,this));return c}),"filter"in Array.prototype||(Array.prototype.filter=function(a,b){for(var c,d=[],e=0,f=this.length;f>e;e++)e in this&&a.call(b,c=this[e],e,this)&&d.push(c);return d}),"every"in Array.prototype||(Array.prototype.every=function(a,b){for(var c=0,d=this.length;d>c;c++)if(c in this&&!a.call(b,this[c],c,this))return!1;return!0}),"some"in Array.prototype||(Array.prototype.some=function(a,b){for(var c=0,d=this.length;d>c;c++)if(c in this&&a.call(b,this[c],c,this))return!0;return!1}),angular.module("loaders",[]).service("$AjaxInterceptor",["$rootScope","$timeout",function(a,b){function c(){var a=document.getElementsByClassName(".loading-content");if(a.length>0){(new Spinner).spin(a[0])}}return{start:function(){++a.requests,c()},complete:function(){b(function(){a.requests>0&&--a.requests},100)},isRequesting:function(){return a.requests>0}}}]);var app=angular.module("events",["ngRoute","constants","webapp.components","loaders","mm.foundation","gettext"]).config(["$routeProvider",function(a){console.log("providing route"),a.when("/",{templateUrl:"/code/events/partials/events.php"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","gettextCatalog","LANG",function(a,b,c){a.requests=0;var d="en_GB",e="en";switch(c){case"de":d="de_DE";break;case"fr":d="fr_FR";break;case"nb":d="nb_NO"}e=d.substr(0,d.indexOf("_")),console.log("webapp language",e),"en_GB"!=d&&(console.log(moment.locale()),b.currentLanguage=d,moment.locale(e))}]);!function(a,b){b.module("events").controller("EventsCtrl",["$scope","$rootScope","$timeout","$q","VENUE_ID","Events","CollectionSlots","$AjaxInterceptor","$modal","$log",function(c,d,e,f,g,h,i,j,k,l){function m(){d.requests=0,j.start(),n(),s(),c.$on("updateEvent",p)}function n(){var a=864e5,b=new Date,c=7,d=new Date(b.getTime()-a*c),g={after:d.getFullYear()+"/"+(d.getMonth()+1)+"/"+d.getDate()};h.get(g).then(function(a){var b=a||[],c=[];b.forEach(function(a,b){var d=a.schedules,e=f.defer();d.length>0&&(a.date=d[0].startDate,a.starttime=r(d[0].startDate),a.endtime=r(d[0].endDate)),function(a){i.get(a).then(function(b){var c=b||[];a.cSlots=[],0==c.length?a.cSlots.push({end:"",eventId:"",leadTime:"",name:"",start:"",step:""}):c.forEach(function(b,c){a.cSlots.push(b),a.collectionCount=c}),e.resolve()},function(a){e.resolve(a.data)})}(a),c.push(e.promise)}),f.all(c).then(function(){z.events=b,e(function(){j.complete()},0),z.redirectFlag=0,z.event_edit_on=1})},function(a){z.redirectFlag=1,z.event_edit_on=0})}function o(a){var b=null,c={venueId:g,name:a.name,description:a.description,visible:a.visible||1};if("string"==typeof a.date){var d=a.date.split("/");b=new Date(d[2],d[1]-1,d[0])}else b=new Date(a.date);return a.hasOwnProperty("outletLocationId")&&"undefined"!==a.outletLocationId&&(c.outletLocationId=a.outletLocationId),c.duration=a.duration,c.schedules=a.schedules,c}function p(a,c){var e=f.defer(),g=o(b.copy(c.evtData));d.requests=0,j.start(),h.update(c.evtData,g).then(function(a){l.log("event ok (update)"),q(a,c.evtData,e)},function(a){console.error("Error saving event. "),e.resolve(a)}),e.promise.then(function(){console.log("all done"),j.complete()})}function q(a,b,c){a.deleteSlots().then(function(){var d=[];b.cSlots.length>0?(b.cSlots.forEach(function(b,c){var e=f.defer();b.eventId=a.id,i.create(b).then(function(){e.resolve()},function(a){e.reject()}),d.push(e.promise)}),f.all(d).then(c.resolve)):c.resolve()},function(a){c.reject(a)})}function r(a){var b=new Date(a),c=a?pad(b.getUTCHours(),2)+":"+pad(b.getUTCMinutes(),2):"";return c}function s(){h.getOutletLocations().then(function(a){var b=a.data,c=v(b);z.outletLocations=w(c)})}function t(a,b){var c=[];return a.forEach(function(d,e){d.parent==b.id&&d.id!=d.parent&&(d.children=t(a,d),c.push(d))}),c}function u(a){return a.forEach(function(b,c){0==b.children.length?a.splice(c,1):b.children=u(b.children)}),a}function v(a){a.sort(a,function(a,b){return a.path<b.path});var b=[];return a.forEach(function(c,d){null==c.parent&&null!=c.id&&(c.children=t(a,c),b.push(c))}),u(b)}function w(a){var b=[];return a.forEach(function(a,c){x(a,1,b)}),b}function x(a,b,c){var d=a.children,e={id:a.id,name:y("--",b)+" "+a.name
};c.push(e),d.forEach(function(a,d){x(a,b+1,c)})}function y(a,b){for(var c="";;){if(1&b&&(c+=a),b>>=1,!b)break;a+=a}return c}var z=this,A=0;z.addEvent=function(){var a=k.open({templateUrl:"/code/events/partials/modal-event.php",controller:"ModalCtrl as modal",resolve:{items:function(){return{outletLocations:z.outletLocations}}}});a.result.then(function(a){var c=f.defer(),e=o(b.copy(a));d.requests=0,j.start(),h.create(e).then(function(b){console.log("event ok (create) ",b),q(b,a,c)},function(a){console.error("Error saving event. "),c.resolve(a)}),c.promise.then(function(){z.events.push(a),j.complete()})},function(){$(document.body).css("overflow","auto")}),$(document.body).css("overflow","hidden")},z.save=function(){$("small.error").hide();var a=!1;if($(".eventTable").each(function(b,c){var d=$(c).find(".eventTDStart"),f=$(c).find(".eventTDEnd"),g=$(c).find(".eventTDStep");return""==d.find("input").val()&&""==f.find("input").val()&&""==g.find("input").val()||""!=d.find("input").val()&&""!=f.find("input").val()&&""!=g.find("input").val()?void(a=!0):(e(function(){"none"!=$(c).find(".eventTDEdit").css("display")&&$(c).find(".eventTDEdit").click()},0),""==d.find("input").val()&&d.find("small.error").show(),""==f.find("input").val()&&f.find("small.error").show(),""==g.find("input").val()&&g.find("small.error").show(),a=!1,!1)}),!a)return!1;var c=(new Date).getTime();if(c-A>300){var d=[];z.isSaving=!0,z.events.forEach(function(a,c){var e=o(b.copy(a)),g=f.defer();a.id&&!String(a.id).match("/^e.*$/")?h.update(a,e).then(function(b){q(b,a,g)},function(a){g.resolve(a)}):h.create(e).then(function(b){q(b,a,g)},function(a){g.resolve(a)}),d.push(g.promise)}),f.all(d).then(function(){z.isSaving=!1},function(){z.isSaving=!1}),A=(new Date).getTime()}},a.pad=function(a,b){return a=a.toString(),a.length<b?pad("0"+a,b):a},d.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)},m()}])}(window,angular),function(a,b){b.module("events").controller("ModalCtrl",["$scope","$timeout","items","$rootScope","$log","DateUtils","gettextCatalog",function(a,b,c,d,e,f,g){function h(a){var b=[];return a.forEach(function(a,c){b.push({name:a.name,start:isNaN(a.start)||""==a.start?"":a.start*a.startFactor,end:isNaN(a.end)||""==a.end?"":a.end*a.endFactor,step:a.step,leadTime:a.leadTime})}),b}function i(a,b,c){var d=[],e=c.substr(0,c.indexOf(":")),f=c.substr(c.indexOf(":")+1);if("CUSTOM"!=a.freq&&""!=a.startDate&&""!=a.endDate){var g=a.startDate.split("/"),h=moment.utc([g[2],g[1]-1,g[0],e,f]).format("YYYY-MM-DDTHH:mm:ss"),i=a.endDate.split("/"),j=moment.utc([i[2],i[1]-1,i[0],e,f]).format("YYYY-MM-DDTHH:mm:ss");d=[{freq:a.freq,startDate:h,endDate:j}]}else b.sortBy(function(a){return a}),b.forEach(function(a,b){var c=moment.utc(a);c.hours(e),c.minutes(f),c=c.format("YYYY-MM-DDTHH:mm:ss"),d.push({freq:"ONCE",startDate:c,endDate:c})});return d}function j(a){var b=isNaN(a.days)?0:Number(a.days),c=isNaN(a.hours)?0:Number(a.hours),d=isNaN(a.minutes)?0:Number(a.minutes),e=24*b*60+60*c+d;return e}function k(){$(".ct-slots").find("select").multiselect({multiple:!1,header:!1,selectedList:1,minWidth:342}),$(".ct-slots").find(".slotName").each(function(){$(this).autocomplete({source:[g.getString("Pre-Show"),g.getString("Pre-Game"),g.getString("Interval"),g.getString("Second-Interval"),g.getString("Half-Time"),g.getString("Post-Show"),g.getString("Post-Game")],delay:10,minLength:0,select:function(b,c){o.slots[b.target.attributes["data-index"].value].name=c.item.value,a.$apply()},position:{my:"left top",at:"left bottom",collision:"none",of:$(this)}})})}function l(a){var c=!0;switch(a){case 1:var d=/\d\d:\d\d/;(!o.eventObj.name||!o.eventObj.starttime||!d.test(o.eventObj.starttime)||""==o.eventObj.days&&""==o.eventObj.hours&&""==o.eventObj.minutes||isNaN(o.eventObj.days)||isNaN(o.eventObj.hours)||isNaN(o.eventObj.minutes))&&(c=!1,d.test(o.eventObj.starttime)||(o.eventObj.starttime=""));break;case 2:var d=/^\d\d\/\d\d\/\d\d\d\d$/;((""==o.schedules.startDate||!d.test(o.schedules.startDate)||""==o.schedules.endDate||!d.test(o.schedules.endDate))&&"CUSTOM"!=o.schedules.freq||"CUSTOM"==o.schedules.freq&&0==o.selectedDays.length)&&(c=!1,/^\d\d\/\d\d\/\d\d\d\d$/.test(o.schedules.startDate)||(o.schedules.startDate=""),/^\d\d\/\d\d\/\d\d\d\d$/.test(o.schedules.endDate)||(o.schedules.endDate=""));break;case 3:o.slots.some(function(a,d){return a.name&&""!=a.name&&(a.leadTime&&""!=a.leadTime&&!o.isInvalidFormat(a.leadTime)||0==a.leadTime)?(""==a.start||null==a.start||isNaN(a.start)||""==a.end||null==a.end||isNaN(a.end)||""==a.step||null==a.step||isNaN(a.step))&&(""!=a.start&&null!=a.start||""!=a.end&&null!=a.end||""!=a.step&&null!=a.step)?(""==a.start&&(a.startError=!0),""==a.end&&(a.endError=!0),(""==a.step||null==a.step)&&(a.hasSteps="true",a.stepError=!0,b(function(){$(".ct-slots").find("select").multiselect("refresh")})),c=!1,!0):(c=!0,!1):(c=!1,!0)})}return c}function m(){o.currentMonth=moment(o.date).utc().startOf("month").valueOf(),b(function(){$("select.titleMonth").multiselect("refresh")})}function n(){$(".schedStartDate").fdatepicker({format:"dd/mm/yyyy",onRender:function(a){return a.valueOf()<now.valueOf()?"disabled":""}}),$(".schedEndDate").fdatepicker({format:"dd/mm/yyyy",onRender:function(a){return a.valueOf()<now.valueOf()?"disabled":""}}),$(".startTime").timepicker({showDuration:!0,timeFormat:"H:i",step:15}),$("select.titleMonth").multiselect({multiple:!1,header:!1,selectedList:1,minWidth:342}),$(".infoTab select").multiselect({multiple:!1,header:!1,selectedList:1,minWidth:342})}var o=this,p=!1,q=!1;o.outletLocations=c.outletLocations,o.activeTab=1,o.totalTabs=3,o.date=new Date,o.minDate=new Date,o.events=[],o.months=[],o.selectedDays=[],o.validation=!1,o.frequencies={once:g.getString("ONCE"),daily:g.getString("DAILY"),weekly:g.getString("WEEKLY"),monthly:g.getString("MONTHLY"),yearly:g.getString("YEARLY"),custom:g.getString("CUSTOM")},o.strings={after:g.getString("after"),before:g.getString("before"),is:g.getString("is"),is_not:g.getString("is not"),all_locations:g.getString("All Locations")};for(var r=0;12>=r;r++){var s=moment().utc().startOf("month").add(r,"M"),t={date:s,valueOf:s.valueOf(),text:s.format("MMMM YYYY"),value:{month:s.month(),year:s.year()}};o.months.push(t)}a.$watch(function(){return o.date},m),o.eventObj=c.eventObj||{name:"",description:"",starttime:"",days:"",hours:"",minutes:""},o.schedules={freq:"ONCE",startDate:"",endDate:""},o.slots=[{eventId:"",startFactor:"-1",endFactor:"-1",hasSteps:"true"}],c.eventObj&&(c.eventObj.duration&&(c.eventObj.days=Math.floor(c.eventObj.duration/24/60),c.eventObj.hours=Math.floor(c.eventObj.duration/60%24),c.eventObj.minutes=Math.floor(c.eventObj.duration%60)),c.eventObj.schedules.length>0&&(c.eventObj.schedules.length>1?(o.schedules.freq="CUSTOM",c.eventObj.schedules.forEach(function(a,b){var c=new Date(a.startDate);o.selectedDays.push(c)})):o.schedules={freq:c.eventObj.schedules[0].freq,startDate:f.getStrDate(c.eventObj.schedules[0].startDate),endDate:f.getStrDate(c.eventObj.schedules[0].endDate)}),c.eventObj.cSlots&&(o.slots=[],c.eventObj.cSlots.forEach(function(a,b){o.slots.push({end:null!=a.end?Math.abs(a.end):"",eventId:a.eventId,leadTime:a.leadTime,name:a.name,start:null!=a.start?Math.abs(a.start):"",step:a.step,startFactor:a.start<0||null==a.start?-1:1,endFactor:a.end<0||null==a.end?-1:1,hasSteps:null!=a.step?"true":"false"})}))),o.next=function(){o.validation=!0,l(o.activeTab)&&(o.validation=!1,o.activeTab<o.totalTabs&&o.activeTab++,b(function(){2!=o.activeTab||p||(p=!0,$(".scheduleTab select").multiselect({multiple:!1,header:!1,selectedList:1,minWidth:342})),3!=o.activeTab||q||(q=!0,k())},0))},o.previous=function(){o.activeTab>1&&o.activeTab--},o.addSlot=function(){o.slots.push({eventId:"",startFactor:"-1",endFactor:"-1",hasSteps:"true"}),b(function(){k()})},o.deleteSlot=function(a){o.slots.some(function(b,c){return a==b?(o.slots.splice(c,1),!0):!1})},o.changeMonth=function(){var a=moment(o.currentMonth).utc(),b=moment(o.date).utc(),c=a.format("YYYY-MM")+"-"+b.format("DD")+" "+b.format("HH:mm:ss");o.date=new Date(c)},o.move=function(b){a.$broadcast("$move",{direction:b}),m()},o.closeModal=function(){o.validation=!0,l(o.activeTab)&&(o.validation=!1,o.eventObj.cSlots=h(o.slots),o.eventObj.schedules=i(o.schedules,o.selectedDays,o.eventObj.starttime),o.eventObj.duration=j(o.eventObj),o.eventObj.date=o.eventObj.schedules[0]?o.eventObj.schedules[0].startDate:"",console.log(o.eventObj.date),$(document.body).css("overflow","auto"),a.$close(o.eventObj))},o.isInvalidFormat=function(a){return isNaN(a)},b(n,0)}])}(window,angular),angular.module("events").directive("slot",["$timeout","$log","gettextCatalog",function(a,b,c){return{templateUrl:"/code/events/js/directives/slot/slot.php",restrict:"A",replace:!0,scope:{slots:"=elements",event_index:"=countevent"},link:function(d,e,f){d.add=function(){var f={end:"",eventId:"",leadTime:"",name:"",start:"",step:""};d.slots.push(f),a(function(){var g=$(e.context.parentElement).find("select").last(),h=$(e.context.parentElement).find(".eventTDCollection .slotName").last();a(function(){g.multiselect({multiple:!1,header:!1,noneSelectedText:c.getString("Choose a Collection Slot"),selectedList:1,minWidth:342}),b.log(h),h.autocomplete({source:[c.getString("Collection Slot: Pre-Show"),c.getString("Collection Slot: Pre-Game"),c.getString("Collection Slot: Interval"),c.getString("Collection Slot: Second-Interval"),c.getString("Collection Slot: Half-Time"),c.getString("Collection Slot: Post-Show"),c.getString("Collection Slot: Post-Game")],delay:10,minLength:0,select:function(a,b){f.name=b.item.value,d.$apply()},position:{my:"left top",at:"left bottom",collision:"none",of:h}})},0),$(e.context.parentElement).find(".optionTR").last().slideRow("down").addClass("eventEdit").removeClass("savedInput"),$("html, body").animate({scrollTop:g.closest("tr").offset().top-($(window).height()-g.closest("tr").outerHeight(!0))/2},200)},0)},d["delete"]=function(a){d.slots.some(function(b,c){return a==b?(d.slots.splice(c,1),!0):!1})}}}}]),angular.module("events").directive("event",["$timeout","$q","$rootScope","Events","$modal","$log","DateUtils","gettextCatalog",function(a,b,c,d,e,f,g,h){return{templateUrl:"/code/events/js/directives/event/event.php",restrict:"E",replace:!0,scope:{events:"=elements",outletLocations:"=outlet"},link:function(b,i,j){function k(a){c.safeApply(function(){b.events.some(function(c,d){return c==a?(b.events.splice(d,1),!0):!1})})}b.expandOptions=function(d,h){var i=$(d.currentTarget).closest(".eventTable"),j=i.find(".eventTDDate input"),k=e.open({templateUrl:"/code/events/partials/modal-event.php",controller:"ModalCtrl as modal",resolve:{items:function(){return{outletLocations:b.outletLocations,eventObj:h}}}});k.result.then(function(b){f.log(b),c.$broadcast("updateEvent",{evtData:b}),a(function(){j.val(g.getStrDate(j.val()))})},function(){f.log("Modal dismissed at: "+new Date),$(document.body).css("overflow","auto")}),$(document.body).css("overflow","hidden")},b.collapseOptions=function(a){var b=$(a.currentTarget),c=b.closest("table");b.hide(),c.find("tr").removeClass("eventEdit"),c.find("tr").addClass("savedInput"),c.find("input").attr("readonly","readonly"),c.find(".eventTDEdit").removeClass("hide"),c.find(".eventTDEdit").show(),c.find(".optionTR").slideRow("up"),c.css("background","transparent"),c.css("box-shadow","0px 0px 0px"),c.css("max-width","100%")},b.duplicate=function(c,d){var e=angular.copy(c);e.id="",b.events.push(e),a(function(){$(".eventTDEdit").last().click();var a=$(".eventTable").last();a.find(".eventTDDate input").fdatepicker({format:"dd/mm/yyyy",onRender:function(a){return a.valueOf()<now.valueOf()?"disabled":""}}),a.find("input[name^=eTime]").timepicker({showDuration:!0,timeFormat:"H:i",step:15}),a.find("input[name^=eETime]").timepicker({showDuration:!0,timeFormat:"H:i",step:15}),a.css("backgroundColor","#fafafa"),a.css("box-shadow","rgba(70, 83, 93, 0.54902) 0px 0px 6px inset"),a.css("max-width","100%"),a.find(".eventSave").is(":visible")||a.find(".eventTDEdit").trigger("click"),$("html, body").animate({scrollTop:$(a).offset().top-($(window).height()-$(a).outerHeight(!0))/2},200)},0)},b["delete"]=function(a){var b=a.id;"undefined"!=typeof b&&""!=b&&String(b).match(/^\d+?$/gi)?noty({layout:"center",type:"confirm",text:h.getString("Are you sure you want to delete this event? Note: all event data will be lost!"),buttons:[{addClass:"alert tiny",text:h.getString("Yes, delete this event!"),onClick:function(b){f.log("Make api request..."),d.deleteEvent(a).then(function(){f.log(arguments),k(a)},function(){noty({type:"error",layout:"topCenter",text:h.getString("Sorry, but there's been an error processing your request.")})}),b.close()}},{addClass:"secondary tiny",text:h.getString("No, go back."),onClick:function(a){a.close()}}]}):noty({layout:"center",type:"confirm",text:h.getString("Are you sure you want to delete this event? Note: all event data will be lost!"),buttons:[{addClass:"alert tiny",text:h.getString("Yes, delete this event!"),onClick:function(b){k(a),b.close()}},{addClass:"secondary tiny",text:h.getString("No, go back."),onClick:function(a){a.close()}}]})},b.formatDate=g.getStrDate}}}]),angular.module("events").constant("preoCalendarConfig",{formatDay:"EEE d",formatMonth:"MMMM",formatYear:"yyyy",formatDayHeader:"EEE",formatDayTitle:"MMMM",formatMonthTitle:"yyyy",datepickerMode:"day",minMode:"day",maxMode:"year",showWeeks:!1,showDays:!1,startingDay:1,yearRange:20,minDate:null,maxDate:null}).controller("PreoCalendarController",["$scope","$attrs","$parse","$interpolate","$timeout","$log","dateFilter","preoCalendarConfig","DateUtils",function(a,b,c,d,e,f,g,h,i){var j=this;j.dateObjectModel={},this.modes=["day","month","year"],this.selectedDays=[],this.frequency="",angular.forEach(["formatDay","formatMonth","formatYear","formatDayHeader","formatDayTitle","formatMonthTitle","minMode","maxMode","showDays","showWeeks","startingDay","yearRange"],function(c,e){j[c]=angular.isDefined(b[c])?8>e?d(b[c])(a.$parent):a.$parent.$eval(b[c]):h[c]}),angular.forEach(["minDate","maxDate"],function(d){b[d]?a.$parent.$watch(c(b[d]),function(a){j[d]=a?new Date(a):null,j.refreshView()}):j[d]=h[d]?new Date(h[d]):null}),a.datepickerMode=a.datepickerMode||h.datepickerMode,a.uniqueId="datepicker-"+a.$id+"-"+Math.floor(1e4*Math.random()),this.activeDate=angular.isDefined(b.initDate)?a.$parent.$eval(b.initDate):new Date,this.isFirstRun=!0,a.$watch("schedules.startDate",function(b,c){c?a.selectedDays=[]:a.schedules.endDate="",""!=b&&b&&a.select(b,c),j.updateFrequency(a.schedules.freq)}),a.$watch("schedules.endDate",function(b,c){""!=b&&b&&j.updateFrequency(a.schedules.freq)}),a.$watch("schedules.freq",function(b,c){"CUSTOM"==c&&b!=c&&(a.selectedDays=[],a.schedules.startDate="",a.schedules.endDate=""),j.frequency=b,j.updateFrequency(a.schedules.freq)}),a.$watch("ngModel",function(b,c){""!=b&&b&&b!=j.activeDate&&(console.log("select day from changing model"),a.select({activeDate:b}))}),this.updateFrequency=function(b){if(a.schedules.startDate&&""!=a.schedules.startDate){var c=i.getDateObj(a.schedules.startDate),d=i.getDateObj(a.schedules.endDate),e=i.daysBetween(c,d);switch(a.selectedDays.length>0&&(a.selectedDays=[a.selectedDays[0]]),b){case"ONCE":var f=i.getDateObj(a.schedules.startDate);f.setDate(f.getDate()+1),a.schedules.endDate=i.getStrDate(f);break;case"DAILY":for(var g=1;e>=g;g++){var f=i.addDays(c,g);a.selectedDays.push(f)}break;case"WEEKLY":for(var h=c,k=6048e5,l=36e5;h.getTime()+k<=d.getTime()+l;)h=i.addDays(h,7),a.selectedDays.push(h);break;case"MONTHLY":var h=c,l=36e5;do h.setMonth(h.getMonth()+1),h.getTime()<=d.getTime()&&a.selectedDays.push(new Date(h));while(h.getTime()<=d.getTime()+l);break;case"YEARLY":for(var h=c;h.getFullYear()+1<=d.getFullYear();)h.setFullYear(h.getFullYear()+1),h.getTime()<=d.getTime()&&a.selectedDays.push(new Date(h));break;case"CUSTOM":a.schedules.startDate="",a.schedules.endDate="",a.selectedDays=[]}}else"CUSTOM"!=a.schedules.freq&&(a.selectedDays.length>0?a.selectedDays=[a.selectedDays[0]]:a.selectedDays=[]);j.refreshView()},a.isActive=function(b){return 0===j.compare(b.date,j.activeDate)?(a.activeDateId=b.uid,!0):!1},this.refreshView=function(){this.element&&this._refreshView()},this.createDateObject=function(a,b){var c=this.isSelected(a);return a.setHours(0),a.setMinutes(0),a.setSeconds(0),{date:a,label:g(a,b),isCurrentMonth:this.isCurrentMonth(a),selected:c,disabled:this.isDisabled(a),current:0===this.compare(a,new Date)}},this.isDisabled=function(c){return this.minDate&&this.compare(c,this.minDate)<0||this.maxDate&&this.compare(c,this.maxDate)>0||b.dateDisabled&&a.dateDisabled({date:c,mode:a.datepickerMode})},this.split=function(a,b){for(var c=[];a.length>0;)c.push(a.splice(0,b));return c},a.select=function(b,c){var d,e=new Date(0,0,0,0,0,0,0),f=!1;if(a.datepickerMode===j.minMode){if("object"==typeof b)d=b.activeDate?b.activeDate:b.date?b.date:b,e.setFullYear(d.getFullYear(),d.getMonth(),d.getDate()),j.activeDate=d,a.ngModel=j.activeDate,"CUSTOM"!=a.schedules.freq||b.hasOwnProperty("activeDate")||(a.selectedDays.some(function(b,c){return e.getTime()==b.getTime()&&(a.selectedDays.splice(c,1),f=!0),f}),f||a.selectedDays.push(e));else if("string"==typeof b){if(d=i.getDateObj(b),e.setFullYear(d.getFullYear(),d.getMonth(),d.getDate()),c){var g=c.split("/"),h=new Date(g[2],g[1]-1,g[0]);a.selectedDays.some(function(b,c){return b.getTime()==h.getTime()?(a.selectedDays.splice(c,1),!0):void 0})}a.selectedDays.push(e)}j.refreshView()}else j.activeDate=d,a.datepickerMode=j.modes[j.modes.indexOf(a.datepickerMode)-1]},a.move=function(b){var c=j.activeDate.getFullYear()+b*(j.step.years||0),d=j.activeDate.getMonth()+b*(j.step.months||0);j.activeDate.setFullYear(c,d,1),a.ngModel=j.activeDate,j.refreshView()},a.$on("$move",function(b,c){a.move(c.direction)}),a.toggleMode=function(b){b=b||1,a.datepickerMode===j.maxMode&&1===b||a.datepickerMode===j.minMode&&-1===b||(a.datepickerMode=j.modes[j.modes.indexOf(a.datepickerMode)+b])},a.keys={13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down"};var k=function(){e(function(){j.element[0].focus()},0,!1)};a.$on("datepicker.focus",k),a.keydown=function(b){var c=a.keys[b.which];if(c&&!b.shiftKey&&!b.altKey)if(b.preventDefault(),b.stopPropagation(),"enter"===c||"space"===c){if(j.isDisabled(j.activeDate))return;a.select(j.activeDate),k()}else!b.ctrlKey||"up"!==c&&"down"!==c?(j.handleKeyDown(c,b),j.refreshView()):(a.toggleMode("up"===c?1:-1),k())}}]).directive("preoCalendarBind",["dateFilter",function(a){return{restrict:"A",replace:!0,require:"^preoCalendar",link:function(b,c,d,e){function f(a,b){return 1!==b||a%4!==0||a%100===0&&a%400!==0?i[b]:29}function g(a,b){var c=new Array(b),d=new Date(a),e=0;for(d.setHours(12);b>e;)c[e++]=new Date(d),d.setDate(d.getDate()+1);return c}function h(a){var b=new Date(a);b.setDate(b.getDate()+4-(b.getDay()||7));var c=b.getTime();return b.setMonth(0),b.setDate(1),Math.floor(Math.round((c-b)/864e5)/7)+1}b.showWeeks=e.showWeeks,b.showDays=e.showDays,e.step={months:1},e.element=c;var i=[31,28,31,30,31,30,31,31,30,31,30,31];e._refreshView=function(){var c=e.activeDate.getFullYear(),d=e.activeDate.getMonth(),f=new Date(c,d,1),i=e.startingDay-f.getDay(),j=i>0?7-i:-i,k=new Date(f);j>0&&k.setDate(-j+1);var l=42;b.attrRows&&(l=7*+b.attrRows);for(var m=g(k,l),n=0;l>n;n++)m[n]=angular.extend(e.createDateObject(m[n],e.formatDay),{secondary:m[n].getMonth()!==d,uid:b.uniqueId+"-"+n});b.labels=new Array(7);for(var o=0;7>o;o++)b.labels[o]={abbr:a(m[o].date,e.formatDayHeader),full:a(m[o].date,"EEEE")};if(b.rows=e.split(m,7),b.showWeeks){b.weekNumbers=[];for(var p=h(b.rows[0][0].date),q=b.rows.length;b.weekNumbers.push(p++)<q;);}},e.compare=function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate())-new Date(b.getFullYear(),b.getMonth(),b.getDate())},e.isSelected=function(a){var c=new Date(a.getFullYear(),a.getMonth(),a.getDate()),d=!1;return b.selectedDays.forEach(function(a,b){var e=new Date(a.getFullYear(),a.getMonth(),a.getDate());return c.getTime()===e.getTime()?(d=!0,!0):void 0}),d},e.isCurrentMonth=function(a){var b=(new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime(),a.getFullYear()),c=a.getMonth(),d=e.activeDate.getFullYear(),f=e.activeDate.getMonth();return b===d&&c===f},e.handleKeyDown=function(a,b){var c=e.activeDate.getDate();if("left"===a)c-=1;else if("up"===a)c-=7;else if("right"===a)c+=1;else if("down"===a)c+=7;else if("pageup"===a||"pagedown"===a){var d=e.activeDate.getMonth()+("pageup"===a?-1:1);e.activeDate.setMonth(d,1),c=Math.min(f(e.activeDate.getFullYear(),e.activeDate.getMonth()),c)}else"home"===a?c=1:"end"===a&&(c=f(e.activeDate.getFullYear(),e.activeDate.getMonth()));e.activeDate.setDate(c)},e.refreshView()}}}]).directive("preoCalendar",function(){return{restrict:"EA",replace:!0,templateUrl:"/code/events/js/directives/preo-calendar/preo-calendar.htm",scope:{datepickerMode:"=?",dateDisabled:"&",attrRows:"@rows",selectedDays:"=",ngModel:"=",schedules:"="},require:["preoCalendar"],controller:"PreoCalendarController",link:function(a,b,c,d){d[0],d[1]}}}),function(a,b){b.module("events").service("CollectionSlots",["$http","$q","VENUE_ID",function(a,b,c){var d={};return d.get=function(a){return Preoday.PickupSlot.getAll(a)},d.create=function(a){return Preoday.PickupSlot.create(a)},d.update=function(a){return a.save()},d["delete"]=function(a){return a["delete"]()},d}])}(window,angular),function(a,b){b.module("events").service("Events",["$http","$q","VENUE_ID",function(a,b,c){var d={},e=c;return d.get=function(a){return Preoday.Event.getAll(e,a)},d.deleteEvent=function(a){function c(a,b){a["delete"]().then(function(a){console.log("deleted all"),console.log(b),b.resolve(a)},function(a){b.reject(a)})}var d=b.defer();return a.cSlots.length>0?a.deleteSlots().then(function(){c(a,d)},function(a){d.reject(a)}):c(a,d),d.promise},d.update=function(a,b){return console.log(a,b),a.save(b)},d.create=function(a){return Preoday.Event.create(e,a)},d.getOutletLocations=function(){return a.get("/api/venues/"+e+"/outletlocations?outlets=false")},d}])}(window,angular),function(a,b){b.module("events").service("DateUtils",["$timeout",function(a){var b={};return b.daysBetween=function(a,b){var c=864e5,d=a.getTime(),e=b.getTime(),f=e-d;return Math.round(f/c)},b.addDays=function(a,b){return new Date(a.getTime()+24*b*60*60*1e3)},b.getDateObj=function(a){var b=a.split("/");return new Date(b[2],b[1]-1,b[0],12)},b.getStrDate=function(a){var b=new Date(a),c=a?pad(String(b.getUTCDate()),2)+"/"+pad(String(b.getUTCMonth()+1),2)+"/"+b.getUTCFullYear():"";return c},b}])}(window,angular),function(){function a(a){for(var b=this.length;b;){var c=this[--b];this[b]=[].concat(a.call(c,c,b),c)}this.sort(function(a,b){for(var c=0,d=a.length;d>c;++c)if(a[c]!=b[c])return a[c]<b[c]?-1:1;return 0});for(var b=this.length;b;)this[--b]=this[b][this[b].length-1];return this}if("function"==typeof Object.defineProperty)try{Object.defineProperty(Array.prototype,"sortBy",{value:a})}catch(b){}Array.prototype.sortBy||(Array.prototype.sortBy=a)}(),angular.module("notification",["ngSanitize"]).controller("confirmModalController",["$scope","$modalInstance","data","deffered","$http","$templateCache","$compile","$sce","$timeout","AccountFeature","ACCOUNT_ID","VENUE_ID","USER_ID",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n="/code/notification/templates/";if(a.title=c.title||"",a.discountCode="",a.appliedDiscount=!1,c.hasOwnProperty("templateFullUrl")&&c.templateFullUrl)angular.extend(a,c.scope);else if(c.hasOwnProperty("templateUrl")&&c.templateUrl){a.templateUrl=c.templateUrl;var o=function(b){i(function(){angular.element("#contentPartial").html(g(b)(a))})},p=f.get(n+c.templateUrl);p?o(p):e.get(n+c.templateUrl).then(function(a){f.put(n+c.templateUrl,a.data),o(a.data)})}else a.content=c.content||"";c.hasOwnProperty("scope")&&c.scope&&(a=angular.extend(a,c.scope)),a.toTrusted=function(a){return h.trustAsHtml(a||"")},a.showTerm=c.showTerm||!1,a.acceptTerm=!1,a.contentClass=c.contentClass||"",a.modifyPositionButtons=c.modifyPositionButtons||!1,c.btnOk===!1?a.btnOk=!1:a.btnOk=c.btnOk||_tr("OK"),c.btnCancel===!1?c.btnCancel=!1:a.btnCancel=c.btnCancel||_tr("CANCEL"),a.changeTerm=function(b){a.acceptTerm=b},a.send=function(){b.close();var c={acceptTerm:a.acceptTerm};a.appliedDiscount&&(c.discountCode=a.discountCode),d.resolve(c)},a.cancel=function(){b.close(),d.reject({acceptTerm:a.acceptTerm})},a.validateDiscountCode=function(){a.errorMsg="",a.discountCode||(a.errorMsg=_tr("Please enter a discount code")),j.getPrice({accountId:k,featureId:a.featureId,code:a.discountCode.toUpperCase(),venueId:l,userId:m},function(b){angular.extend(a,b),a.appliedDiscount=!0},function(b){400===b.status&&b.data&&(a.errorMsg=b.data.message)})}}]).service("$notification",["$modal","$q","$sce",function(a,b,c){var d="/code/notification/templates/",e=function(c){var e=b.defer();c=c||{},c.hasOwnProperty("templateFullUrl")&&c.templateFullUrl&&(c.templateFullUrl=d+c.templateFullUrl);var f=a.open({templateUrl:c.templateFullUrl||"/code/notification/notification.php",windowClass:"modal-preoday "+(c.windowClass||""),controller:"confirmModalController",resolve:{data:function(){return c},deffered:function(){return e}}});return f.opened.then(function(){setTimeout(function(){$(".modal-preoday").addClass("active")},400)}),e.promise};return{confirm:e}}]);