angular.module("delivery",["ngResource","delivery.resources","delivery.controllers","delivery.directives"]),angular.module("delivery.resources",["ngResource"]).factory("Resources",["$resource",function(a){var b=a("/api/venues/:id",{id:"@id"},{patch:{method:"PUT"}}),c=a("/api/venues/:id/settings",{id:"@id"},{patch:{method:"PATCH"}}),d=a("/api/venues/:venueId/messages/:id",{venueId:"@venueId",id:"@id"},{put:{method:"PUT"}});return{Venue:b,VenueSettings:c,VenueMessages:d}}]),angular.module("delivery.controllers",[]).controller("deliveryController",["$scope","$http","Resources","$q","VENUE_ID",function(a,b,c,d,e){function f(){for(var b in a.messages)for(var c in a.messages[b]){var d=a.messages[b][c],e=a.getPlaceholder(b,c);d.name=e.name,d.content=e.content,d.active=1}}function g(){for(var b in a.messages)for(var c in a.messages[b]){var d=a.messages[b][c];if(d.name&&""!=d.name.trim()||d.content&&""!=d.content.trim())return!1}return!0}function h(a){return a.id?""!==a.name.trim()&&""!==a.content.trim()?a.$put():a.$remove():a.name&&""!=a.name.trim()&&a.content&&""!==a.content.trim()?a.$save({venueId:e}):!0}a.isPosting=!1,a.selected=1,a.triedSubmit=!1,a.finishedLoading=!1;var i={notify:["ORDER_NOTIFY"],reject:["ORDER_REJECT"]},j={notify:[{content:_tr("Your order is running 15 mins late"),name:_tr("Late Order")},{content:_tr("Your order is on its way"),name:_tr("En-route")},{content:_tr("There is a problem with your order. Please call us"),name:_tr("Call us")}],reject:[{content:_tr("Your address is out of our delivery zone"),name:_tr("Out of zone")},{content:_tr("Sorry, that item is out of stock"),name:_tr("Out of stock")},{content:_tr("Sorry, Your order has been rejected. Please call us"),name:_tr("Call us")}]};a.venue=c.Venue.get({id:e},function(){},function(){console.log("error",arguments)});{var k=c.VenueSettings.get({id:e},function(b){a.venueSettings=b},function(){console.log("error",arguments)});c.VenueMessages.query({venueId:e},function(b){a.messages={notify:[],reject:[]};for(var d=0,e=0,f=0;6>f;f++)if(b.length>f){var g=b[f];console.log(g),i.notify.indexOf(g.type)>-1?(a.messages.notify.push(g),d++):(a.messages.reject.push(g),e++)}else if(3>d){var h=new c.VenueMessages({name:"",content:"",type:i.notify[0],active:0});d++,a.messages.notify.push(h)}else{var h=new c.VenueMessages({name:"",content:"",type:i.reject[0],active:0});e++,a.messages.reject.push(h)}console.log(a.messages),a.finishedLoading=!0},function(){console.log("error",arguments)})}a.validateMessage=function(b){var c=Boolean(b.content)?!Boolean(b.name):Boolean(b.name);return c&&a.triedSubmit},a.validateActive=function(a){return a&&a.name&&a.content?""===a.name.trim()&&""===a.content.trim()?(a.active=0,!1):!0:(a.active=0,!1)},a.processForm=function(){if(a.isPosting=!0,a.triedSubmit=!0,!a.deliveryForm.$valid)return a.isPosting=!1,!1;var b=a.messages.reject.concat(a.messages.notify);for(var c in b)delete b[c].typeString,delete b[c].suppressed;delete a.venue.ccySymbol,d.all([a.venue.$patch({id:e}).$promise,k.$patch({id:e}).$promise,h(b[0]).$promise,h(b[1]).$promise,h(b[2]).$promise,h(b[3]).$promise,h(b[4]).$promise,h(b[5]).$promise]).then(function(){a.isPosting=!1,noty({type:"success",layout:"topCenter",text:_tr("Successfully saved delivery settings.")})},function(){a.isPosting=!1,noty({type:"error",layout:"topCenter",text:_tr("Sorry, but there's been an error processing your request.")})})},a.getPlaceholder=function(a,b){return j[a][b]},a.onChangeDeliverFlag=function(){1==a.venue.deliverFlag&&g()&&f()}}]);var directives=angular.module("delivery.directives",[]);directives.directive("percent",["$filter",function(a){var b=function(b){var c=b.match(/^(\d+)/);return null!==c?a("number")(parseFloat(b)/100):void 0},c=function(b){return a("number")(100*parseFloat(b))};return{require:"ngModel",link:function(a,d,e,f){f.$parsers.unshift(b),f.$formatters.unshift(c)}}}]),directives.directive("currency",function(){function a(a,c,d,e){function f(a){var b=Math.pow(10,k);return Math.round(a*b)/b}function g(a){return parseFloat(a).toFixed(k)}function h(a){return e.$isEmpty(a)?"":""+a}var i,j=parseFloat(d.min||0),k=parseFloat(d.precision||2);e.$parsers.push(function(a){0===a.indexOf(".")&&(a="0"+a),0===a.indexOf("-")&&(j>=0?(a=null,e.$setViewValue(""),e.$render()):"-"===a&&(a=""));var c=e.$isEmpty(a);return c||b.test(a)?i=""===a?null:c?a:parseFloat(a):(e.$setViewValue(h(i)),e.$render()),e.$setValidity("number",!0),i}),e.$formatters.push(h);var l=function(a){return!e.$isEmpty(a)&&j>a?void e.$setValidity("min",!1):(e.$setValidity("min",!0),a)};if(e.$parsers.push(l),e.$formatters.push(l),d.max){var m=parseFloat(d.max),n=function(a){return!e.$isEmpty(a)&&a>m?void e.$setValidity("max",!1):(e.$setValidity("max",!0),a)};e.$parsers.push(n),e.$formatters.push(n)}k>-1&&(e.$parsers.push(function(a){return a?f(a):a}),e.$formatters.push(function(a){return a?g(a):a})),c.bind("blur",function(){var a=e.$modelValue;a&&(e.$viewValue=g(a),e.$render())})}var b=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/;return{restrict:"A",require:"ngModel",link:a}});